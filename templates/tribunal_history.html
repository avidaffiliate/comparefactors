{% extends "base.html" %}

{% block title %}Tribunal Record | {{ factor.name }} | Compare Factors{% endblock %}

{% block meta %}
<meta name="description" content="Tribunal history for {{ factor.name }} (last 5 years). {{ stats.total_cases }} cases, {{ stats.upheld_rate }}% upheld. View complaint patterns, enforcement orders, and compensation awarded.">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://comparefactors.co.uk/factors/{{ factor.slug }}/tribunal/">
{% endblock %}

{% block content %}
<nav class="breadcrumb">
    <a href="/">Home</a><span class="sep">›</span>
    <a href="/factors/">Factors</a><span class="sep">›</span>
    <a href="/factors/{{ factor.slug }}/">{{ factor.name }}</a><span class="sep">›</span>
    <span>Tribunal Record</span>
</nav>

<article class="tribunal-history-page">

    <!-- HEADER -->
    <header class="page-header">
        <div class="header-main">
            <a href="/factors/{{ factor.slug }}/" class="back-link">← {{ factor.name }}</a>
            <h1>Tribunal Record</h1>
            <p class="last-updated">Analysis period: {{ stats.five_year_cutoff }}–{{ stats.analysis_end_year }} (5-year horizon) · Last updated: {{ stats.last_updated }} · <a href="#data-freshness">Update schedule</a></p>
        </div>
        <a href="/get-quotes/?exclude={{ factor.registration_number }}" class="btn-primary">Get Alternative Quotes</a>
    </header>

    <!-- EXECUTIVE SUMMARY -->
    <section class="section summary-section">
        <div class="summary-narrative">
            <p>
                <strong>{{ factor.name }}</strong> has faced <strong>{{ stats.total_cases }} tribunal complaint{{ 's' if stats.total_cases != 1 else '' }}</strong> in the last 5 years ({{ stats.five_year_cutoff }}–{{ stats.analysis_end_year }}),
                with <strong>{{ stats.upheld_count }} upheld or partially upheld</strong> ({{ stats.upheld_rate }}%).
                {% if stats.most_recent_case_date %}
                The most recent case in our dataset was <strong>{{ stats.most_recent_case_date }}</strong>.
                {% endif %}
            </p>
        </div>

        <!-- Risk Band Banner -->
        <div class="risk-band-banner risk-band-banner--{{ stats.risk_band | lower }}">
            <span class="risk-band-label">Tribunal Risk Rating</span>
            <span class="risk-band-value">{{ stats.risk_band }}</span>
            <a href="#methodology" class="risk-band-link">What's this?</a>
        </div>

        <div class="summary-grid">
            <div class="summary-stat">
                <span class="stat-value">{{ stats.total_cases }}</span>
                <span class="stat-label">Total Cases</span>
                <span class="stat-context">Last 5 years</span>
            </div>
            <div class="summary-stat">
                <span class="stat-value">{{ stats.upheld_rate }}%</span>
                <span class="stat-label">Upheld Rate</span>
                <span class="stat-context">Complaints upheld</span>
            </div>
            <div class="summary-stat">
                <span class="stat-value">{{ stats.pfeo_count }}</span>
                <span class="stat-label">PFEOs Issued</span>
                <span class="stat-context">{{ stats.pfeo_rate }}% of cases</span>
            </div>
            <div class="summary-stat">
                <span class="stat-value">£{{ '{:,.0f}'.format(stats.total_compensation) }}</span>
                <span class="stat-label">Compensation</span>
                <span class="stat-context">Total ordered</span>
            </div>
        </div>
    </section>

    <!-- TREND CHART -->
    {% if stats.cases_by_year %}
    <section class="section">
        <h2 class="section-title">Cases Over Time</h2>
        <div class="trend-chart">
            {% set max_cases = stats.cases_by_year.values() | max %}
            {% for year, data in stats.cases_by_year.items() %}
            {% set count = data.count if data is mapping else data %}
            {% set annotation = data.annotation if data is mapping else none %}
            <div class="trend-row">
                <span class="trend-year">{{ year }}</span>
                <div class="trend-bar-container">
                    <div class="trend-bar" style="width: {{ (count / max_cases * 100) | round }}%">
                        {% if annotation %}
                        <span class="trend-annotation" title="{{ annotation }}">*</span>
                        {% endif %}
                    </div>
                </div>
                <span class="trend-count">{{ count }}</span>
                {% if annotation %}
                <span class="trend-note">{{ annotation }}</span>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% if stats.trend_notes %}
        <p class="trend-context">{{ stats.trend_notes }}</p>
        {% endif %}
    </section>
    {% endif %}

    <!-- OUTCOME BREAKDOWN -->
    <section class="section">
        <h2 class="section-title">Outcome Breakdown</h2>
        <div class="outcome-grid">
            {% for outcome in stats.outcomes %}
            <div class="outcome-item outcome-{{ outcome.type | lower | replace(' ', '-') }}">
                <span class="outcome-count">{{ outcome.count }}</span>
                <span class="outcome-label">{{ outcome.type }}</span>
                <span class="outcome-pct">{{ outcome.percentage }}%</span>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- COMPLAINT PATTERNS -->
    {% if stats.complaint_categories %}
    <section class="section">
        <h2 class="section-title">What Homeowners Complain About</h2>
        <p class="section-intro">Categories based on {{ stats.categorized_cases }} cases with detailed analysis. Cases may have multiple categories.</p>
        <div class="category-chart">
            {% set max_cat = stats.complaint_categories[0].count if stats.complaint_categories else 1 %}
            {% for cat in stats.complaint_categories %}
            <div class="category-row">
                <span class="category-name">{{ cat.name | title }}</span>
                <div class="category-bar-container">
                    <div class="category-bar" style="width: {{ (cat.count / max_cat * 100) | round }}%"></div>
                </div>
                <span class="category-stats">{{ cat.count }} cases ({{ cat.percentage }}%)</span>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- CODE BREACHES -->
    {% if stats.code_breaches %}
    <section class="section">
        <h2 class="section-title">Code of Conduct Breaches</h2>
        <p class="section-intro">Sections of the <a href="https://www.gov.scot/publications/property-factors-scotland-act-2011-code-of-conduct-for-property-factors-2/" target="_blank" rel="noopener">Property Factors Code</a> most commonly breached.</p>
        <div class="data-table-wrapper">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Section</th>
                        <th>Description</th>
                        <th>Breaches</th>
                    </tr>
                </thead>
                <tbody>
                    {% for breach in stats.code_breaches %}
                    <tr>
                        <td><strong>{{ breach.section }}</strong></td>
                        <td>{{ breach.description }}</td>
                        <td>{{ breach.count }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
    {% endif %}

    <!-- ENFORCEMENT SUMMARY -->
    <section class="section">
        <h2 class="section-title">Enforcement &amp; Compensation</h2>
        
        <div class="enforcement-grid">
            <div class="enforcement-block">
                <h3>Property Factor Enforcement Orders</h3>
                <p class="enforcement-headline">
                    <strong>{{ stats.pfeo_count }}</strong> of {{ stats.total_cases }} cases ({{ stats.pfeo_rate }}%)
                </p>
                {% if stats.pfeo_requirements %}
                <p class="enforcement-subhead">Common requirements ordered:</p>
                <ul class="enforcement-list">
                    {% for req in stats.pfeo_requirements %}
                    <li>{{ req.description }} ({{ req.count }} case{{ 's' if req.count != 1 else '' }})</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="enforcement-block">
                <h3>Compensation Ordered</h3>
                <p class="enforcement-headline">
                    <strong>£{{ '{:,.0f}'.format(stats.total_compensation) }}</strong> total
                </p>
                {% if stats.compensation_breakdown %}
                <table class="mini-table">
                    <tbody>
                        {% for band in stats.compensation_breakdown %}
                        <tr>
                            <td>{{ band.range }}</td>
                            <td>{{ band.count }} case{{ 's' if band.count != 1 else '' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
                {% if stats.largest_award %}
                <p class="enforcement-note">
                    Largest single award: <strong>£{{ '{:,.0f}'.format(stats.largest_award.amount) }}</strong>
                    {% if stats.largest_award.pdf_url %}
                    (<a href="{{ stats.largest_award.pdf_url }}" target="_blank" rel="noopener">{{ stats.largest_award.case_ref }}</a>)
                    {% else %}
                    ({{ stats.largest_award.case_ref }})
                    {% endif %}
                </p>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- NOTABLE CASES -->
    {% if notable_cases %}
    <section class="section">
        <h2 class="section-title">Notable Cases</h2>
        <div class="notable-cases">
            {% for case in notable_cases %}
            {% set outcome_display = case.outcome_display | default(case.outcome_type) %}
            <div class="notable-case">
                <div class="notable-header">
                    <span class="notable-ref">{{ case.case_ref }}</span>
                    <span class="outcome-badge outcome-{{ outcome_display | lower | replace(' ', '-') }}">{{ outcome_display }}</span>
                </div>
                <div class="notable-meta">
                    {{ case.hearing_date[:10] }}
                    {% if case.property_location %}· {{ case.property_location }}{% endif %}
                    {% if case.severity_score %}· Severity {{ '%.1f' | format(case.severity_score) }}/10{% endif %}
                </div>
                {% if case.key_quote %}
                <blockquote class="notable-quote">"{{ case.key_quote | truncate(200) }}"</blockquote>
                {% endif %}
                <div class="notable-footer">
                    {% if case.pfeo_issued %}<span class="notable-tag">PFEO</span>{% endif %}
                    {% if case.compensation_awarded and case.compensation_awarded > 0 %}
                    <span class="notable-tag">£{{ '{:,.0f}'.format(case.compensation_awarded) }}</span>
                    {% endif %}
                    {% if case.pdf_url %}
                    <a href="{{ case.pdf_url }}" class="notable-link" target="_blank" rel="noopener">View decision (PDF) →</a>
                    {% else %}
                    <a href="https://www.housingandpropertychamber.scot/search-decisions?search={{ case.case_ref | urlencode }}" class="notable-link" target="_blank" rel="noopener">Find decision →</a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- FULL CASE LIST -->
    <section class="section">
        <h2 class="section-title">All Cases</h2>
        
        <div class="case-filters">
            <label>
                <span>Outcome:</span>
                <select id="filter-outcome">
                    <option value="">All</option>
                    <option value="upheld">Upheld</option>
                    <option value="partially-upheld">Partially Upheld</option>
                    <option value="dismissed-rejected">Dismissed/Rejected</option>
                    <option value="pfeo">PFEO Issued</option>
                    <option value="withdrawn">Withdrawn</option>
                </select>
            </label>
            <label>
                <span>PFEO:</span>
                <select id="filter-pfeo">
                    <option value="">Any</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </label>
        </div>

        <div class="case-table-wrapper">
            <table class="case-table" id="case-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Case Ref</th>
                        <th>Outcome</th>
                        <th>PFEO</th>
                        <th>Compensation</th>
                        <th>Severity</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for case in cases %}
                    {% set outcome_display = case.outcome_display | default(case.outcome_type) %}
                    {% set outcome_class = outcome_display | lower | replace(' ', '-') %}
                    {% set filter_outcome = 'dismissed-rejected' if ('dismissed' in outcome_class or 'rejected' in outcome_class) else ('pfeo' if 'pfeo' in outcome_class else outcome_class) %}
                    <tr data-outcome="{{ filter_outcome }}" data-pfeo="{{ 'yes' if case.pfeo_issued else 'no' }}">
                        <td>{{ case.hearing_date[:10] if case.hearing_date else '—' }}</td>
                        <td><code>{{ case.case_ref }}</code></td>
                        <td><span class="outcome-pill outcome-{{ outcome_class }}">{{ outcome_display }}</span></td>
                        <td>{{ '⚠️' if case.pfeo_issued else '—' }}</td>
                        <td>{{ '£{:,.0f}'.format(case.compensation_awarded) if case.compensation_awarded and case.compensation_awarded > 0 else '—' }}</td>
                        <td>{{ '%.1f' | format(case.severity_score) if case.severity_score else '—' }}</td>
                        <td>
                            {% if case.pdf_url %}
                            <a href="{{ case.pdf_url }}" target="_blank" rel="noopener">PDF</a>
                            {% else %}
                            —
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if cases | length > 20 %}
        <button class="show-all-btn" id="show-all-cases">Show all {{ cases | length }} cases</button>
        {% endif %}

        <div class="recent-decisions-note">
            <p>
                <strong>Looking for older decisions?</strong><br>
                This analysis covers the last 5 years ({{ stats.five_year_cutoff }}–{{ stats.analysis_end_year }}). 
                <a href="https://housingandpropertychamber.scot/apply-tribunal/property-factors/property-factors-decisions" target="_blank" rel="noopener">
                    Search the Housing &amp; Property Chamber for the full archive →
                </a>
            </p>
        </div>
    </section>

    <!-- GEOGRAPHIC DISTRIBUTION -->
    {% if stats.geographic %}
    <section class="section">
        <h2 class="section-title">Where Complaints Originate</h2>
        <div class="geo-chart">
            {% set max_geo = stats.geographic[0].count if stats.geographic else 1 %}
            {% for area in stats.geographic %}
            <div class="geo-row">
                <span class="geo-area">{{ area.name }} ({{ area.code }})</span>
                <div class="geo-bar-container">
                    <div class="geo-bar" style="width: {{ (area.count / max_geo * 100) | round }}%"></div>
                </div>
                <span class="geo-count">{{ area.count }}</span>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- METHODOLOGY -->
    <section class="section" id="methodology">
        <details class="methodology-toggle">
            <summary>
                <h2 class="section-title inline-title">Context &amp; Methodology</h2>
            </summary>
            <div class="methodology-content">
                <h3 id="data-freshness">Data freshness &amp; update schedule</h3>
                <p>This analysis covers tribunal decisions from the last 5 years ({{ stats.five_year_cutoff }}–{{ stats.analysis_end_year }}). We update our database <strong>quarterly</strong> as new decisions are published by the Housing and Property Chamber.</p>
                <ul>
                    <li><strong>Last updated:</strong> {{ stats.last_updated }}</li>
                    <li><strong>Next scheduled update:</strong> {{ stats.next_update }}</li>
                </ul>
                <p>For decisions published after our last update, <a href="https://www.housingandpropertychamber.scot/search-decisions" target="_blank" rel="noopener">search the Housing &amp; Property Chamber directly →</a></p>
                
                <h3>What is the Housing and Property Chamber?</h3>
                <p>The Housing and Property Chamber is part of the First-tier Tribunal for Scotland. It handles complaints against property factors under the Property Factors (Scotland) Act 2011.</p>
                
                <h3>How is the case rate calculated?</h3>
                <p>Case rate = (weighted tribunal cases ÷ properties managed) × 10,000. Standard cases count as 1 point, cases with PFEOs that were complied with count as 1.5, and PFEO breaches count as 3. This normalizes for factor size and enforcement severity, allowing fair comparison between factors of different sizes.</p>
                
                <h3>What do the risk bands mean?</h3>
                <ul>
                    <li><strong>CLEAN:</strong> No adverse tribunal cases in the past 5 years</li>
                    <li><strong>GREEN:</strong> ≤10 weighted cases per 10,000 properties — low tribunal exposure</li>
                    <li><strong>ORANGE:</strong> 11–30 weighted cases per 10,000 — elevated tribunal exposure, or 2+ PFEO breaches</li>
                    <li><strong>RED:</strong> &gt;30 weighted cases per 10,000 — significant tribunal exposure</li>
                    <li><strong>LIMITED:</strong> Fewer than 50 properties managed — insufficient data for reliable rating</li>
                </ul>
                <p><em>Weighted cases: Standard adverse cases count as 1, PFEO complied = 1.5×, PFEO breached = 3×</em></p>
                
                <h3>How is severity score calculated?</h3>
                <p>Each case receives a severity score (0-10) based on objective factors AI-extracted from the tribunal decision:</p>
                <ul>
                    <li><strong>Outcome weight:</strong> Upheld complaints score higher than dismissed</li>
                    <li><strong>Enforcement:</strong> PFEO issued adds 2-3 points</li>
                    <li><strong>Compensation:</strong> Awards over £500 add 1-2 points</li>
                    <li><strong>Code breaches:</strong> Multiple sections breached increases score</li>
                    <li><strong>Factor conduct:</strong> Non-attendance or non-cooperation adds 1-2 points</li>
                </ul>
                <p>Average severity across all cases provides a quality signal beyond simple case counts.</p>
                
                <h3>Important notes</h3>
                <ul>
                    <li>A dismissed case doesn't necessarily mean the homeowner was wrong—it may reflect procedural issues or burden of proof.</li>
                    <li>Larger factors naturally accumulate more cases over time. Always consider the rate, not just the count.</li>
                    <li>Year-over-year spikes may reflect tribunal processing backlogs rather than sudden service deterioration.</li>
                    <li>Recent decisions (within the last quarter) may not yet be reflected in our analysis.</li>
                </ul>
                
                <p><a href="https://www.housingandpropertychamber.scot/" target="_blank" rel="noopener">Visit the Housing &amp; Property Chamber website →</a></p>
            </div>
        </details>
    </section>

    <!-- CTA -->
    <section class="section cta-section">
        <h2>Concerned about this record?</h2>
        <p>Get free, no-obligation quotes from factors serving your area.</p>
        <a href="/get-quotes/?exclude={{ factor.registration_number }}" class="btn-primary btn-large">Get Quotes from Alternative Factors</a>
        <p class="cta-back"><a href="/factors/{{ factor.slug }}/">← Back to {{ factor.name }} Profile</a></p>
    </section>

</article>
{% endblock %}

{% block scripts %}
<script>
// Simple filtering for case table
document.addEventListener('DOMContentLoaded', function() {
    const table = document.getElementById('case-table');
    const outcomeFilter = document.getElementById('filter-outcome');
    const pfeoFilter = document.getElementById('filter-pfeo');
    const showAllBtn = document.getElementById('show-all-cases');
    
    function filterTable() {
        const outcome = outcomeFilter.value;
        const pfeo = pfeoFilter.value;
        const rows = table.querySelectorAll('tbody tr');
        
        rows.forEach(row => {
            const rowOutcome = row.dataset.outcome;
            // Handle dismissed-rejected as a combined filter
            let matchOutcome = !outcome || rowOutcome === outcome;
            if (outcome === 'dismissed-rejected') {
                matchOutcome = rowOutcome === 'dismissed-rejected' || rowOutcome === 'dismissed' || rowOutcome === 'rejected';
            }
            const matchPfeo = !pfeo || row.dataset.pfeo === pfeo;
            row.style.display = (matchOutcome && matchPfeo) ? '' : 'none';
        });
    }
    
    if (outcomeFilter) outcomeFilter.addEventListener('change', filterTable);
    if (pfeoFilter) pfeoFilter.addEventListener('change', filterTable);
    
    // Show all cases
    if (showAllBtn) {
        const rows = table.querySelectorAll('tbody tr');
        // Initially hide rows beyond 20
        rows.forEach((row, i) => {
            if (i >= 20) row.classList.add('hidden-row');
        });
        
        showAllBtn.addEventListener('click', function() {
            rows.forEach(row => row.classList.remove('hidden-row'));
            this.style.display = 'none';
        });
    }
});
</script>
{% endblock %}

{% block styles %}
<style>
/* Tribunal History Page Styles */
.tribunal-history-page {
    max-width: 900px;
    margin: 0 auto;
    padding: 0 1rem 3rem;
}

/* Header */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 1.5rem 0 2rem;
    border-bottom: 1px solid var(--border);
    margin-bottom: 2rem;
    gap: 1rem;
}

.back-link {
    font-size: 0.85rem;
    color: var(--primary);
    text-decoration: none;
}

.back-link:hover {
    text-decoration: underline;
}

.page-header h1 {
    font-size: 1.75rem;
    margin: 0.25rem 0 0.5rem;
}

.last-updated {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin: 0;
}

.btn-primary {
    display: inline-block;
    background: var(--primary);
    color: #fff;
    padding: 0.75rem 1.25rem;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 500;
    font-size: 0.9rem;
    white-space: nowrap;
}

.btn-primary:hover {
    background: var(--primary-dark);
}

.btn-large {
    padding: 1rem 2rem;
    font-size: 1rem;
}

/* Sections */
.section {
    margin-bottom: 2.5rem;
    padding-bottom: 2.5rem;
    border-bottom: 1px solid var(--border-light);
}

.section:last-child {
    border-bottom: none;
}

.section-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0 0 1rem;
    color: var(--text);
}

.section-intro {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-bottom: 1rem;
}

/* Summary Section */
.summary-narrative {
    background: var(--bg-muted);
    padding: 1.25rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    font-size: 1.05rem;
    line-height: 1.6;
}

.summary-narrative p {
    margin: 0;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
}

.summary-stat {
    background: #fff;
    border: 1px solid var(--border);
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
}

.stat-value {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text);
}

.stat-label {
    display: block;
    font-size: 0.75rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin: 0.25rem 0;
}

.stat-context {
    display: block;
    font-size: 0.7rem;
    color: var(--text-muted);
}

.stat-context a {
    color: var(--primary);
}

/* Risk Band Banner */
.risk-band-banner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    padding: 0.75rem 1.25rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    font-size: 0.9rem;
}

.risk-band-label {
    font-weight: 500;
    opacity: 0.9;
}

.risk-band-value {
    font-size: 1.25rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.risk-band-link {
    font-size: 0.8rem;
    opacity: 0.8;
    text-decoration: none;
}

.risk-band-link:hover {
    text-decoration: underline;
}

.risk-band-banner--clean {
    background: #ecfdf5;
    color: #065f46;
}

.risk-band-banner--clean .risk-band-link { color: #047857; }

.risk-band-banner--green {
    background: #d1fae5;
    color: #065f46;
}

.risk-band-banner--green .risk-band-link { color: #047857; }

.risk-band-banner--amber {
    background: #fef3c7;
    color: #92400e;
}

.risk-band-banner--amber .risk-band-link { color: #b45309; }

.risk-band-banner--orange {
    background: #ffedd5;
    color: #9a3412;
}

.risk-band-banner--orange .risk-band-link { color: #c2410c; }

.risk-band-banner--red {
    background: #fee2e2;
    color: #991b1b;
}

.risk-band-banner--red .risk-band-link { color: #b91c1c; }

/* Risk band colors (for other uses) */
.risk-clean { color: #059669; }
.risk-green { color: #10b981; }
.risk-amber { color: #f59e0b; }
.risk-orange { color: #f97316; }
.risk-red { color: #dc2626; }

/* Trend Chart */
.trend-chart {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.25rem;
}

.trend-row {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.trend-year {
    width: 50px;
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--text-muted);
}

.trend-bar-container {
    flex: 1;
    height: 24px;
    background: var(--bg-muted);
    border-radius: 4px;
    overflow: hidden;
}

.trend-bar {
    height: 100%;
    background: var(--primary);
    border-radius: 4px;
    min-width: 4px;
    position: relative;
}

.trend-annotation {
    position: absolute;
    right: 4px;
    top: 50%;
    transform: translateY(-50%);
    color: #fff;
    font-weight: 700;
    font-size: 0.75rem;
    cursor: help;
}

.trend-count {
    width: 30px;
    font-size: 0.9rem;
    font-weight: 600;
    text-align: right;
}

.trend-note {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-left: 0.5rem;
    font-style: italic;
}

.trend-context {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-top: 1rem;
    font-style: italic;
}

.text-success {
    color: #059669;
}

.text-warning {
    color: #b45309;
}

/* Outcome Grid */
.outcome-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
}

.outcome-item {
    padding: 1.25rem;
    border-radius: 8px;
    text-align: center;
    border: 1px solid var(--border-light);
}

.outcome-count {
    display: block;
    font-size: 2rem;
    font-weight: 700;
}

.outcome-label {
    display: block;
    font-size: 0.85rem;
    font-weight: 500;
    margin: 0.25rem 0;
}

.outcome-pct {
    display: block;
    font-size: 0.8rem;
    opacity: 0.8;
}

.outcome-upheld {
    background: #fef2f2;
    color: #b91c1c;
}

.outcome-partially-upheld {
    background: #fffbeb;
    color: #b45309;
}

.outcome-dismissed {
    background: #f0fdf4;
    color: #15803d;
}

.outcome-rejected,
.outcome-dismissed-rejected {
    background: #f0fdf4;
    color: #15803d;
}

.outcome-withdrawn {
    background: #f8fafc;
    color: #64748b;
}

.outcome-pfeo-complied,
.outcome-pfeo-proposed,
.outcome-pfeo-pending,
.outcome-pfeo-breached,
.outcome-breach---no-order {
    background: #fef2f2;
    color: #b91c1c;
}

/* Category Chart */
.category-chart, .geo-chart {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.25rem;
}

.category-row, .geo-row {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.category-name, .geo-area {
    width: 140px;
    font-size: 0.9rem;
    font-weight: 500;
}

.category-bar-container, .geo-bar-container {
    flex: 1;
    height: 20px;
    background: var(--bg-muted);
    border-radius: 4px;
    overflow: hidden;
}

.category-bar {
    height: 100%;
    background: #6366f1;
    border-radius: 4px;
}

.geo-bar {
    height: 100%;
    background: #10b981;
    border-radius: 4px;
}

.category-stats, .geo-count {
    width: 120px;
    font-size: 0.85rem;
    color: var(--text-muted);
    text-align: right;
}

/* Data Table */
.data-table-wrapper {
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
}

.data-table th,
.data-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid var(--border-light);
}

.data-table th {
    font-weight: 600;
    color: var(--text-muted);
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    background: var(--bg-muted);
}

.data-table tbody tr:hover {
    background: var(--bg-muted);
}

.data-table td:last-child {
    text-align: right;
}

/* Enforcement Grid */
.enforcement-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
}

.enforcement-block {
    background: #fff;
    border: 1px solid var(--border);
    padding: 1.25rem;
    border-radius: 8px;
}

.enforcement-block h3 {
    font-size: 0.9rem;
    font-weight: 600;
    margin: 0 0 0.75rem;
    color: var(--text);
}

.enforcement-headline {
    font-size: 1.1rem;
    margin: 0 0 0.75rem;
}

.enforcement-subhead {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin: 0.75rem 0 0.5rem;
}

.enforcement-list {
    margin: 0;
    padding-left: 1.25rem;
    font-size: 0.9rem;
}

.enforcement-list li {
    margin-bottom: 0.25rem;
}

.enforcement-note {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin: 0.75rem 0 0;
}

.mini-table {
    width: 100%;
    font-size: 0.85rem;
}

.mini-table td {
    padding: 0.25rem 0;
}

.mini-table td:last-child {
    text-align: right;
    color: var(--text-muted);
}

/* Notable Cases */
.notable-cases {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.notable-case {
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.25rem;
}

.notable-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.notable-ref {
    font-family: var(--font-mono);
    font-size: 0.85rem;
    color: var(--text-muted);
}

.outcome-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.outcome-badge.outcome-upheld {
    background: #fef2f2;
    color: #b91c1c;
}

.outcome-badge.outcome-partially-upheld {
    background: #fffbeb;
    color: #b45309;
}

.outcome-badge.outcome-dismissed {
    background: #f0fdf4;
    color: #15803d;
}

.outcome-badge.outcome-rejected,
.outcome-badge.outcome-dismissed-rejected {
    background: #f0fdf4;
    color: #15803d;
}

.outcome-badge.outcome-pfeo-complied,
.outcome-badge.outcome-pfeo-proposed,
.outcome-badge.outcome-pfeo-pending,
.outcome-badge.outcome-pfeo-breached,
.outcome-badge.outcome-breach---no-order {
    background: #fef2f2;
    color: #b91c1c;
}

.outcome-badge.outcome-withdrawn,
.outcome-badge.outcome-unknown {
    background: #f8fafc;
    color: #64748b;
}

.notable-meta {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 0.75rem;
}

.notable-quote {
    font-size: 0.95rem;
    font-style: italic;
    color: var(--text);
    border-left: 3px solid var(--border);
    padding-left: 1rem;
    margin: 0.75rem 0;
    line-height: 1.5;
}

.notable-footer {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.75rem;
}

.notable-tag {
    background: var(--bg-muted);
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 500;
}

.notable-link {
    margin-left: auto;
    font-size: 0.85rem;
    color: var(--primary);
    text-decoration: none;
}

.notable-link:hover {
    text-decoration: underline;
}

/* Case Table */
.case-filters {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
}

.case-filters label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
}

.case-filters select {
    padding: 0.4rem 0.75rem;
    border: 1px solid var(--border);
    border-radius: 4px;
    font-size: 0.85rem;
}

.case-table-wrapper {
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
}

.case-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
}

.case-table th,
.case-table td {
    padding: 0.75rem 0.5rem;
    text-align: left;
    border-bottom: 1px solid var(--border-light);
}

.case-table th {
    font-weight: 600;
    color: var(--text-muted);
    font-size: 0.75rem;
    text-transform: uppercase;
    background: var(--bg-muted);
}

.case-table tbody tr:hover {
    background: var(--bg-muted);
}

.case-table code {
    font-size: 0.8rem;
    background: var(--bg-muted);
    padding: 0.15rem 0.35rem;
    border-radius: 3px;
}

.case-table a {
    color: var(--primary);
    text-decoration: none;
}

.outcome-pill {
    display: inline-block;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 500;
}

.outcome-pill.outcome-upheld {
    background: #fef2f2;
    color: #b91c1c;
}

.outcome-pill.outcome-partially-upheld {
    background: #fffbeb;
    color: #b45309;
}

.outcome-pill.outcome-dismissed {
    background: #f0fdf4;
    color: #15803d;
}

.outcome-pill.outcome-rejected,
.outcome-pill.outcome-dismissed-rejected {
    background: #f0fdf4;
    color: #15803d;
}

.outcome-pill.outcome-pfeo-complied,
.outcome-pill.outcome-pfeo-proposed,
.outcome-pill.outcome-pfeo-pending,
.outcome-pill.outcome-pfeo-breached,
.outcome-pill.outcome-breach---no-order {
    background: #fef2f2;
    color: #b91c1c;
}

.outcome-pill.outcome-withdrawn {
    background: #f8fafc;
    color: #64748b;
}

.outcome-pill.outcome-unknown {
    background: #f8fafc;
    color: #64748b;
}

.hidden-row {
    display: none;
}

.show-all-btn {
    display: block;
    width: 100%;
    padding: 0.75rem;
    margin-top: 1rem;
    background: var(--bg-muted);
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 0.9rem;
    cursor: pointer;
}

.show-all-btn:hover {
    background: var(--bg-hover);
}

/* Recent Decisions Note */
.recent-decisions-note {
    margin-top: 1.5rem;
    padding: 1rem 1.25rem;
    background: #fefce8;
    border: 1px solid #fef08a;
    border-radius: 8px;
    font-size: 0.9rem;
}

.recent-decisions-note p {
    margin: 0;
    line-height: 1.5;
}

.recent-decisions-note a {
    color: var(--primary);
}

/* Methodology */
.methodology-toggle {
    background: #fff;
    border-radius: 8px;
    border: 1px solid var(--border);
}

.methodology-toggle summary {
    padding: 1rem 1.25rem;
    cursor: pointer;
    list-style: none;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-weight: 500;
    transition: background 0.15s ease;
}

.methodology-toggle summary:hover {
    background: var(--bg-hover, #f1f5f9);
}

.methodology-toggle summary::after {
    content: "▸";
    font-size: 0.85rem;
    color: var(--text-muted);
    transition: transform 0.2s ease;
}

.methodology-toggle[open] summary::after {
    transform: rotate(90deg);
}

.methodology-toggle summary::-webkit-details-marker {
    display: none;
}

.inline-title {
    display: inline;
    margin: 0;
}

.methodology-content {
    padding: 0 1.25rem 1.25rem;
}

.methodology-content h3 {
    font-size: 0.95rem;
    margin: 1.25rem 0 0.5rem;
}

.methodology-content p,
.methodology-content ul {
    font-size: 0.9rem;
    line-height: 1.6;
    margin-bottom: 0.75rem;
}

.methodology-content ul {
    padding-left: 1.5rem;
}

/* CTA */
.cta-section {
    text-align: center;
    background: var(--bg-muted);
    padding: 2rem;
    border-radius: 8px;
    border: none;
}

.cta-section h2 {
    margin: 0 0 0.5rem;
}

.cta-section > p {
    color: var(--text-muted);
    margin-bottom: 1.25rem;
}

.cta-back {
    margin-top: 1rem;
    font-size: 0.9rem;
}

.cta-back a {
    color: var(--text-muted);
    text-decoration: none;
}

.cta-back a:hover {
    color: var(--primary);
}

/* Responsive */
@media (max-width: 800px) {
    .summary-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .outcome-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .enforcement-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 600px) {
    .page-header {
        flex-direction: column;
    }
    
    .summary-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .risk-band-banner {
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    .risk-band-label {
        width: 100%;
        text-align: center;
        font-size: 0.8rem;
    }
    
    .category-name, .geo-area {
        width: 100px;
        font-size: 0.8rem;
    }
    
    .category-stats {
        width: 80px;
        font-size: 0.75rem;
    }
    
    .case-table {
        font-size: 0.75rem;
    }
    
    .case-table th:nth-child(5),
    .case-table td:nth-child(5),
    .case-table th:nth-child(6),
    .case-table td:nth-child(6) {
        display: none;
    }
}
</style>
{% endblock %}