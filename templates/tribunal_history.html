{% extends "base.html" %}

{# 
Tribunal History Template v2.0 - Mobile & SEO Optimized

Changes:
- SEO: Better title tag and meta description with actual data
- Mobile: Table converts to stacked cards on small screens
- Mobile: Improved spacing and touch targets
- Added structured data for BreadcrumbList
#}

{% block title %}{{ factor.name }} Tribunal Cases & Complaints | Compare Factors{% endblock %}

{% block meta %}
{# SEO-optimized meta description with actual data #}
<meta name="description" content="{{ factor.name }}: {{ stats.total_cases }} tribunal case{{ 's' if stats.total_cases != 1 else '' }} ({{ stats.five_year_cutoff }}–{{ stats.analysis_end_year }}), {{ stats.upheld_rate }}% upheld{% if stats.total_compensation > 0 %}, £{{ '{:,.0f}'.format(stats.total_compensation) }} compensation{% endif %}. {{ stats.risk_band }} risk rating. Full complaint history and analysis.">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://comparefactors.co.uk/factors/{{ factor.slug }}/tribunal/">

<!-- Open Graph -->
<meta property="og:title" content="{{ factor.name }} - Tribunal Record | Compare Factors">
<meta property="og:description" content="{{ stats.total_cases }} tribunal cases, {{ stats.upheld_rate }}% upheld. {{ stats.risk_band }} risk rating.">
<meta property="og:url" content="https://comparefactors.co.uk/factors/{{ factor.slug }}/tribunal/">
<meta property="og:type" content="website">

<!-- Structured Data: BreadcrumbList -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
        {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://comparefactors.co.uk/"},
        {"@type": "ListItem", "position": 2, "name": "Factors", "item": "https://comparefactors.co.uk/factors/"},
        {"@type": "ListItem", "position": 3, "name": "{{ factor.name }}", "item": "https://comparefactors.co.uk/factors/{{ factor.slug }}/"},
        {"@type": "ListItem", "position": 4, "name": "Tribunal Record"}
    ]
}
</script>
{% endblock %}

{% block content %}
<nav class="breadcrumb">
    <a href="/">Home</a><span class="sep">›</span>
    <a href="/factors/">Factors</a><span class="sep">›</span>
    <a href="/factors/{{ factor.slug }}/">{{ factor.name }}</a><span class="sep">›</span>
    <span>Tribunal Record</span>
</nav>

<article class="tribunal-history-page">

    <!-- HEADER -->
    <header class="page-header">
        <div class="header-main">
            <a href="/factors/{{ factor.slug }}/" class="back-link">← {{ factor.name }}</a>
            <h1>Tribunal Record</h1>
            <p class="last-updated">{{ stats.five_year_cutoff }}–{{ stats.analysis_end_year }} · Updated {{ stats.last_updated }}</p>
        </div>
    </header>

    <!-- EXECUTIVE SUMMARY -->
    <section class="section summary-section">
        <div class="summary-narrative">
            <p>
                <strong>{{ factor.name }}</strong> has faced <strong>{{ stats.total_cases }} tribunal case{{ 's' if stats.total_cases != 1 else '' }}</strong> in the last 5 years,
                with <strong>{{ stats.upheld_count }} upheld or partially upheld</strong> ({{ stats.upheld_rate }}%).
                {% if stats.most_recent_case_date %}
                Most recent: <strong>{{ stats.most_recent_case_date }}</strong>.
                {% endif %}
            </p>
        </div>

        <!-- Risk Band Banner -->
        <div class="risk-band-banner risk-band-banner--{{ stats.risk_band | lower }}">
            <span class="risk-band-label">Tribunal Rating</span>
            <span class="risk-band-value">{{ stats.risk_band }}</span>
            <a href="#methodology" class="risk-band-link">How is this calculated?</a>
        </div>

        <div class="summary-grid">
            <div class="summary-stat">
                <span class="stat-value">{{ stats.total_cases }}</span>
                <span class="stat-label">Cases</span>
            </div>
            <div class="summary-stat">
                <span class="stat-value">{{ stats.upheld_rate }}%</span>
                <span class="stat-label">Upheld</span>
            </div>
            <div class="summary-stat">
                <span class="stat-value">{{ stats.pfeo_count }}</span>
                <span class="stat-label">PFEOs</span>
            </div>
            <div class="summary-stat">
                <span class="stat-value">£{{ '{:,.0f}'.format(stats.total_compensation) }}</span>
                <span class="stat-label">Compensation</span>
            </div>
        </div>
    </section>

    <!-- TREND CHART -->
    {% if stats.cases_by_year %}
    <section class="section">
        <h2 class="section-title">Cases Over Time</h2>
        <div class="trend-chart">
            {% set max_cases = stats.cases_by_year.values() | max %}
            {% for year, data in stats.cases_by_year.items() %}
            {% set count = data.count if data is mapping else data %}
            {% set annotation = data.annotation if data is mapping else none %}
            <div class="trend-row">
                <span class="trend-year">{{ year }}</span>
                <div class="trend-bar-container">
                    <div class="trend-bar" style="width: {{ (count / max_cases * 100) | round }}%">
                        {% if annotation %}
                        <span class="trend-annotation" title="{{ annotation }}">*</span>
                        {% endif %}
                    </div>
                </div>
                <span class="trend-count">{{ count }}</span>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- OUTCOME BREAKDOWN -->
    <section class="section">
        <h2 class="section-title">Outcomes</h2>
        <div class="outcome-grid">
            {% for outcome in stats.outcomes %}
            <div class="outcome-item outcome-{{ outcome.type | lower | replace(' ', '-') }}">
                <span class="outcome-count">{{ outcome.count }}</span>
                <span class="outcome-label">{{ outcome.type }}</span>
                <span class="outcome-pct">{{ outcome.percentage }}%</span>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- COMPLAINT PATTERNS -->
    {% if stats.complaint_categories %}
    <section class="section">
        <h2 class="section-title">Complaint Types</h2>
        <p class="section-intro">Based on {{ stats.categorized_cases }} analysed cases.</p>
        <div class="category-chart">
            {% set max_cat = stats.complaint_categories[0].count if stats.complaint_categories else 1 %}
            {% for cat in stats.complaint_categories %}
            <div class="category-row">
                <span class="category-name">{{ cat.name | title }}</span>
                <div class="category-bar-container">
                    <div class="category-bar" style="width: {{ (cat.count / max_cat * 100) | round }}%"></div>
                </div>
                <span class="category-stats">{{ cat.count }}</span>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- CODE BREACHES -->
    {% if stats.code_breaches %}
    <section class="section">
        <h2 class="section-title">Code Breaches</h2>
        <p class="section-intro">Most commonly breached sections of the <a href="https://www.gov.scot/publications/property-factors-scotland-act-2011-code-of-conduct-for-property-factors-2/" target="_blank" rel="noopener">Property Factors Code</a>.</p>
        <div class="breach-list">
            {% for breach in stats.code_breaches %}
            <div class="breach-item">
                <span class="breach-section">§{{ breach.section }}</span>
                <span class="breach-desc">{{ breach.description }}</span>
                <span class="breach-count">{{ breach.count }}</span>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- ENFORCEMENT SUMMARY -->
    <section class="section">
        <h2 class="section-title">Enforcement & Compensation</h2>
        
        <div class="enforcement-grid">
            <div class="enforcement-block">
                <h3>Enforcement Orders (PFEOs)</h3>
                <p class="enforcement-headline">
                    <strong>{{ stats.pfeo_count }}</strong> of {{ stats.total_cases }} cases ({{ stats.pfeo_rate }}%)
                </p>
                {% if stats.pfeo_requirements %}
                <ul class="enforcement-list">
                    {% for req in stats.pfeo_requirements %}
                    <li>{{ req.description }} ({{ req.count }})</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="enforcement-block">
                <h3>Compensation Awarded</h3>
                <p class="enforcement-headline">
                    <strong>£{{ '{:,.0f}'.format(stats.total_compensation) }}</strong> total
                </p>
                {% if stats.largest_award %}
                <p class="enforcement-note">
                    Largest: <strong>£{{ '{:,.0f}'.format(stats.largest_award.amount) }}</strong>
                    {% if stats.largest_award.pdf_url %}
                    (<a href="{{ stats.largest_award.pdf_url }}" target="_blank" rel="noopener">{{ stats.largest_award.case_ref }}</a>)
                    {% else %}
                    ({{ stats.largest_award.case_ref }})
                    {% endif %}
                </p>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- NOTABLE CASES -->
    {% if notable_cases %}
    <section class="section">
        <h2 class="section-title">Notable Cases</h2>
        <div class="notable-cases">
            {% for case in notable_cases %}
            {% set outcome_display = case.outcome_display | default(case.outcome_type) %}
            <div class="notable-case">
                <div class="notable-header">
                    <span class="notable-ref">{{ case.case_ref }}</span>
                    <span class="outcome-badge outcome-{{ outcome_display | lower | replace(' ', '-') }}">{{ outcome_display }}</span>
                </div>
                <div class="notable-meta">
                    {{ case.hearing_date[:10] }}
                    {% if case.severity_score %}· Severity {{ '%.1f' | format(case.severity_score) }}/10{% endif %}
                </div>
                {% if case.key_quote %}
                <blockquote class="notable-quote">"{{ case.key_quote | truncate(180) }}"</blockquote>
                {% endif %}
                <div class="notable-footer">
                    {% if case.pfeo_issued %}<span class="notable-tag tag-pfeo">PFEO</span>{% endif %}
                    {% if case.compensation_awarded and case.compensation_awarded > 0 %}
                    <span class="notable-tag tag-comp">£{{ '{:,.0f}'.format(case.compensation_awarded) }}</span>
                    {% endif %}
                    {% if case.pdf_url %}
                    <a href="{{ case.pdf_url }}" class="notable-link" target="_blank" rel="noopener">View PDF →</a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- FULL CASE LIST -->
    <section class="section">
        <h2 class="section-title">All Cases</h2>
        
        <div class="case-filters">
            <label>
                <span>Outcome:</span>
                <select id="filter-outcome">
                    <option value="">All</option>
                    <option value="upheld">Upheld</option>
                    <option value="partially-upheld">Partial</option>
                    <option value="dismissed-rejected">Dismissed</option>
                    <option value="withdrawn">Withdrawn</option>
                </select>
            </label>
        </div>

        <!-- Desktop: Table view -->
        <div class="case-table-wrapper desktop-only">
            <table class="case-table" id="case-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Reference</th>
                        <th>Outcome</th>
                        <th>PFEO</th>
                        <th>Comp.</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for case in cases %}
                    {% set outcome_display = case.outcome_display | default(case.outcome_type) %}
                    {% set outcome_class = outcome_display | lower | replace(' ', '-') %}
                    {% set filter_outcome = 'dismissed-rejected' if ('dismissed' in outcome_class or 'rejected' in outcome_class) else ('pfeo' if 'pfeo' in outcome_class else outcome_class) %}
                    <tr class="case-row {% if loop.index > 10 %}hidden-row{% endif %}" data-outcome="{{ filter_outcome }}" data-pfeo="{{ 'yes' if case.pfeo_issued else 'no' }}">
                        <td>{{ case.hearing_date[:10] if case.hearing_date else '—' }}</td>
                        <td><code>{{ case.case_ref }}</code></td>
                        <td><span class="outcome-pill outcome-{{ outcome_class }}">{{ outcome_display }}</span></td>
                        <td>{% if case.pfeo_issued %}<span class="pfeo-flag">⚠️</span>{% else %}—{% endif %}</td>
                        <td>{% if case.compensation_awarded and case.compensation_awarded > 0 %}£{{ '{:,.0f}'.format(case.compensation_awarded) }}{% else %}—{% endif %}</td>
                        <td>
                            {% if case.pdf_url %}
                            <a href="{{ case.pdf_url }}" target="_blank" rel="noopener" class="pdf-link">PDF</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Mobile: Card view -->
        <div class="case-cards mobile-only">
            {% for case in cases %}
            {% set outcome_display = case.outcome_display | default(case.outcome_type) %}
            {% set outcome_class = outcome_display | lower | replace(' ', '-') %}
            {% set filter_outcome = 'dismissed-rejected' if ('dismissed' in outcome_class or 'rejected' in outcome_class) else outcome_class %}
            <div class="case-card {% if loop.index > 5 %}hidden-card{% endif %}" data-outcome="{{ filter_outcome }}">
                <div class="case-card-header">
                    <div class="case-card-ref">
                        <code>{{ case.case_ref }}</code>
                        <span class="case-card-date">{{ case.hearing_date[:10] if case.hearing_date else '' }}</span>
                    </div>
                    <span class="outcome-pill outcome-{{ outcome_class }}">{{ outcome_display }}</span>
                </div>
                <div class="case-card-body">
                    {% if case.pfeo_issued or (case.compensation_awarded and case.compensation_awarded > 0) %}
                    <div class="case-card-tags">
                        {% if case.pfeo_issued %}<span class="card-tag tag-pfeo">PFEO issued</span>{% endif %}
                        {% if case.compensation_awarded and case.compensation_awarded > 0 %}
                        <span class="card-tag tag-comp">£{{ '{:,.0f}'.format(case.compensation_awarded) }}</span>
                        {% endif %}
                    </div>
                    {% endif %}
                    {% if case.pdf_url %}
                    <a href="{{ case.pdf_url }}" target="_blank" rel="noopener" class="case-card-link">View decision →</a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        {% if cases | length > 10 %}
        <button class="show-all-btn" id="show-all-cases">Show all {{ cases | length }} cases</button>
        {% endif %}

        <div class="source-note">
            <p>
                Data from <a href="https://housingandpropertychamber.scot/apply-tribunal/property-factors/property-factors-decisions" target="_blank" rel="noopener">Housing & Property Chamber</a>. 
                Last 5 years ({{ stats.five_year_cutoff }}–{{ stats.analysis_end_year }}).
            </p>
        </div>
    </section>

    <!-- METHODOLOGY -->
    <section class="section" id="methodology">
        <details class="methodology-toggle">
            <summary>
                <h2 class="section-title inline-title">How We Calculate Ratings</h2>
            </summary>
            <div class="methodology-content">
                <h3>Risk Rating Bands</h3>
                <ul>
                    <li><strong>CLEAN:</strong> No adverse tribunal cases</li>
                    <li><strong>GREEN:</strong> ≤10 cases per 10,000 properties</li>
                    <li><strong>ORANGE:</strong> 11–30 per 10,000, or 2+ PFEO breaches</li>
                    <li><strong>RED:</strong> >30 per 10,000 properties</li>
                    <li><strong>LIMITED:</strong> <50 properties (insufficient data)</li>
                </ul>
                
                <h3>Data & Updates</h3>
                <ul>
                    <li><strong>Last updated:</strong> {{ stats.last_updated }}</li>
                    <li><strong>Next update:</strong> {{ stats.next_update }}</li>
                </ul>
                <p>We update quarterly. For the latest decisions, <a href="https://www.housingandpropertychamber.scot/search-decisions" target="_blank" rel="noopener">search the HPC directly →</a></p>
            </div>
        </details>
    </section>

    <!-- CTA -->
    <section class="section cta-section">
        <h2>Looking for alternatives?</h2>
        <p>Compare quotes from factors with better tribunal records.</p>
        <a href="/get-quotes/?exclude={{ factor.registration_number }}" class="btn-primary">Get Free Quotes</a>
        <p class="cta-back"><a href="/factors/{{ factor.slug }}/">← Back to {{ factor.name }} profile</a></p>
    </section>

</article>
{% endblock %}

{% block styles %}
<style>
/* =============================================================================
   TRIBUNAL HISTORY PAGE - Mobile Optimized
   ============================================================================= */

:root {
    --primary: #1e40af;
    --primary-dark: #1e3a8a;
    --text: #1e293b;
    --text-muted: #64748b;
    --bg: #ffffff;
    --bg-muted: #f8fafc;
    --bg-hover: #f1f5f9;
    --border: #e2e8f0;
    --border-light: #f1f5f9;
    --red-50: #fef2f2;
    --red-600: #dc2626;
    --red-700: #b91c1c;
    --amber-50: #fffbeb;
    --amber-700: #b45309;
    --green-50: #f0fdf4;
    --green-600: #16a34a;
    --green-700: #15803d;
    --orange-50: #fff7ed;
    --orange-600: #ea580c;
}

/* Layout */
.tribunal-history-page {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 1rem 2rem;
}

.breadcrumb {
    max-width: 800px;
    margin: 0 auto;
    padding: 0.75rem 1rem;
    font-size: 0.8rem;
    color: var(--text-muted);
}

.breadcrumb a { color: var(--text-muted); text-decoration: none; }
.breadcrumb a:hover { color: var(--primary); }
.breadcrumb .sep { margin: 0 0.4rem; color: var(--border); }

/* Page Header */
.page-header {
    padding: 1rem 0 1.5rem;
    border-bottom: 1px solid var(--border);
    margin-bottom: 1.5rem;
}

.back-link {
    font-size: 0.85rem;
    color: var(--primary);
    text-decoration: none;
}

.page-header h1 {
    font-size: 1.5rem;
    margin: 0.5rem 0 0.25rem;
    color: var(--text);
}

.last-updated {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin: 0;
}

/* Sections */
.section {
    margin-bottom: 2rem;
}

.section-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text);
    margin: 0 0 1rem;
}

.section-intro {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin: -0.5rem 0 1rem;
}

/* Summary Narrative */
.summary-narrative {
    font-size: 0.95rem;
    line-height: 1.6;
    margin-bottom: 1rem;
}

/* Risk Band Banner */
.risk-band-banner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    font-size: 0.9rem;
}

.risk-band-label { font-weight: 500; opacity: 0.9; }
.risk-band-value { font-size: 1.1rem; font-weight: 700; text-transform: uppercase; }
.risk-band-link { font-size: 0.75rem; opacity: 0.8; text-decoration: none; }
.risk-band-link:hover { text-decoration: underline; }

.risk-band-banner--clean { background: #ecfdf5; color: #047857; }
.risk-band-banner--green { background: #f0fdf4; color: var(--green-700); }
.risk-band-banner--orange { background: var(--orange-50); color: var(--orange-600); }
.risk-band-banner--red { background: var(--red-50); color: var(--red-700); }
.risk-band-banner--limited { background: var(--bg-muted); color: var(--text-muted); }

/* Summary Grid */
.summary-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.75rem;
}

.summary-stat {
    text-align: center;
    padding: 1rem 0.5rem;
    background: var(--bg-muted);
    border-radius: 8px;
}

.stat-value {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text);
    line-height: 1.2;
}

.stat-label {
    display: block;
    font-size: 0.7rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.03em;
    margin-top: 0.25rem;
}

/* Trend Chart */
.trend-chart {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.trend-row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.trend-year {
    width: 45px;
    font-size: 0.8rem;
    color: var(--text-muted);
    flex-shrink: 0;
}

.trend-bar-container {
    flex: 1;
    height: 20px;
    background: var(--bg-muted);
    border-radius: 4px;
    overflow: hidden;
}

.trend-bar {
    height: 100%;
    background: var(--primary);
    border-radius: 4px;
    min-width: 4px;
}

.trend-count {
    width: 28px;
    font-size: 0.85rem;
    font-weight: 600;
    text-align: right;
    flex-shrink: 0;
}

/* Outcome Grid */
.outcome-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.5rem;
}

.outcome-item {
    text-align: center;
    padding: 0.75rem 0.5rem;
    border-radius: 8px;
    background: var(--bg-muted);
}

.outcome-count {
    display: block;
    font-size: 1.25rem;
    font-weight: 700;
}

.outcome-label {
    display: block;
    font-size: 0.7rem;
    margin-top: 0.2rem;
}

.outcome-pct {
    display: block;
    font-size: 0.7rem;
    opacity: 0.7;
}

.outcome-upheld { background: var(--red-50); color: var(--red-700); }
.outcome-partially-upheld { background: var(--amber-50); color: var(--amber-700); }
.outcome-dismissed, .outcome-rejected, .outcome-dismissed-rejected { background: var(--green-50); color: var(--green-700); }
.outcome-withdrawn { background: var(--bg-muted); color: var(--text-muted); }

/* Category Chart */
.category-chart {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.category-row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.category-name {
    width: 100px;
    font-size: 0.8rem;
    flex-shrink: 0;
}

.category-bar-container {
    flex: 1;
    height: 16px;
    background: var(--bg-muted);
    border-radius: 4px;
    overflow: hidden;
}

.category-bar {
    height: 100%;
    background: #6366f1;
    border-radius: 4px;
    min-width: 4px;
}

.category-stats {
    width: 30px;
    font-size: 0.8rem;
    font-weight: 600;
    text-align: right;
    flex-shrink: 0;
}

/* Code Breaches - Mobile friendly list instead of table */
.breach-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.breach-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    background: var(--bg-muted);
    border-radius: 6px;
}

.breach-section {
    font-weight: 600;
    font-size: 0.8rem;
    color: var(--primary);
    flex-shrink: 0;
}

.breach-desc {
    flex: 1;
    font-size: 0.85rem;
    color: var(--text);
}

.breach-count {
    font-weight: 600;
    font-size: 0.9rem;
    flex-shrink: 0;
}

/* Enforcement Grid */
.enforcement-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

.enforcement-block {
    padding: 1rem;
    background: var(--bg-muted);
    border-radius: 8px;
}

.enforcement-block h3 {
    font-size: 0.85rem;
    font-weight: 600;
    margin: 0 0 0.5rem;
}

.enforcement-headline {
    font-size: 0.9rem;
    margin: 0 0 0.5rem;
}

.enforcement-headline strong {
    font-size: 1.25rem;
}

.enforcement-list {
    font-size: 0.8rem;
    margin: 0;
    padding-left: 1.25rem;
}

.enforcement-list li {
    margin-bottom: 0.25rem;
}

.enforcement-note {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin: 0.5rem 0 0;
}

/* Notable Cases */
.notable-cases {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.notable-case {
    padding: 1rem;
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 8px;
}

.notable-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.notable-ref {
    font-family: monospace;
    font-size: 0.85rem;
    font-weight: 600;
}

.notable-meta {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
}

.notable-quote {
    font-size: 0.85rem;
    font-style: italic;
    color: var(--text-muted);
    margin: 0 0 0.75rem;
    padding-left: 0.75rem;
    border-left: 2px solid var(--border);
    line-height: 1.5;
}

.notable-footer {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.notable-tag {
    font-size: 0.7rem;
    font-weight: 600;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
}

.tag-pfeo { background: var(--red-50); color: var(--red-700); }
.tag-comp { background: var(--amber-50); color: var(--amber-700); }

.notable-link {
    font-size: 0.8rem;
    color: var(--primary);
    text-decoration: none;
    margin-left: auto;
}

/* Outcome Badge */
.outcome-badge {
    display: inline-block;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 600;
}

.outcome-badge.outcome-upheld { background: var(--red-50); color: var(--red-700); }
.outcome-badge.outcome-partially-upheld { background: var(--amber-50); color: var(--amber-700); }
.outcome-badge.outcome-dismissed, .outcome-badge.outcome-rejected { background: var(--green-50); color: var(--green-700); }

/* Case Filters */
.case-filters {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.case-filters label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
}

.case-filters select {
    padding: 0.4rem 0.75rem;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 0.85rem;
    background: #fff;
}

/* =============================================================================
   DESKTOP: Table View
   ============================================================================= */

.desktop-only {
    display: block;
}

.mobile-only {
    display: none;
}

.case-table-wrapper {
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
}

.case-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
}

.case-table th,
.case-table td {
    padding: 0.65rem 0.5rem;
    text-align: left;
    border-bottom: 1px solid var(--border-light);
}

.case-table th {
    font-weight: 600;
    color: var(--text-muted);
    font-size: 0.7rem;
    text-transform: uppercase;
    background: var(--bg-muted);
}

.case-table tbody tr:hover {
    background: var(--bg-muted);
}

.case-table code {
    font-size: 0.8rem;
    background: var(--bg-muted);
    padding: 0.1rem 0.3rem;
    border-radius: 3px;
}

.case-table .pdf-link {
    color: var(--primary);
    text-decoration: none;
    font-size: 0.8rem;
}

.outcome-pill {
    display: inline-block;
    padding: 0.15rem 0.4rem;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 500;
    white-space: nowrap;
}

.outcome-pill.outcome-upheld { background: var(--red-50); color: var(--red-700); }
.outcome-pill.outcome-partially-upheld { background: var(--amber-50); color: var(--amber-700); }
.outcome-pill.outcome-dismissed, .outcome-pill.outcome-rejected, .outcome-pill.outcome-dismissed-rejected { background: var(--green-50); color: var(--green-700); }
.outcome-pill.outcome-pfeo-complied, .outcome-pill.outcome-pfeo-breached, .outcome-pill.outcome-breach { background: var(--red-50); color: var(--red-700); }
.outcome-pill.outcome-withdrawn, .outcome-pill.outcome-unknown { background: var(--bg-muted); color: var(--text-muted); }

.hidden-row {
    display: none;
}

/* =============================================================================
   MOBILE: Card View
   ============================================================================= */

.case-cards {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.case-card {
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.875rem;
}

.case-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.case-card-ref {
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
}

.case-card-ref code {
    font-size: 0.85rem;
    font-weight: 600;
    background: var(--bg-muted);
    padding: 0.15rem 0.4rem;
    border-radius: 4px;
}

.case-card-date {
    font-size: 0.75rem;
    color: var(--text-muted);
}

.case-card-body {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 0.5rem;
}

.case-card-tags {
    display: flex;
    gap: 0.4rem;
    flex-wrap: wrap;
}

.card-tag {
    font-size: 0.7rem;
    font-weight: 500;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
}

.case-card-link {
    font-size: 0.8rem;
    color: var(--primary);
    text-decoration: none;
    white-space: nowrap;
}

.hidden-card {
    display: none;
}

/* Show All Button */
.show-all-btn {
    display: block;
    width: 100%;
    padding: 0.75rem;
    margin-top: 1rem;
    background: var(--bg-muted);
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 0.9rem;
    cursor: pointer;
    text-align: center;
}

.show-all-btn:hover {
    background: var(--bg-hover);
}

/* Source Note */
.source-note {
    margin-top: 1rem;
    padding: 0.75rem 1rem;
    background: #fefce8;
    border: 1px solid #fef08a;
    border-radius: 8px;
    font-size: 0.8rem;
}

.source-note p {
    margin: 0;
}

.source-note a {
    color: var(--primary);
}

/* Methodology */
.methodology-toggle {
    background: #fff;
    border-radius: 8px;
    border: 1px solid var(--border);
}

.methodology-toggle summary {
    padding: 0.875rem 1rem;
    cursor: pointer;
    list-style: none;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-weight: 500;
}

.methodology-toggle summary:hover {
    background: var(--bg-hover);
}

.methodology-toggle summary::after {
    content: "+";
    font-size: 1.1rem;
    color: var(--text-muted);
}

.methodology-toggle[open] summary::after {
    content: "−";
}

.methodology-toggle summary::-webkit-details-marker {
    display: none;
}

.inline-title {
    display: inline;
    margin: 0;
    font-size: 1rem;
}

.methodology-content {
    padding: 0 1rem 1rem;
}

.methodology-content h3 {
    font-size: 0.9rem;
    margin: 1rem 0 0.4rem;
}

.methodology-content p,
.methodology-content ul {
    font-size: 0.85rem;
    line-height: 1.6;
    margin-bottom: 0.5rem;
}

.methodology-content ul {
    padding-left: 1.25rem;
}

/* CTA Section */
.cta-section {
    text-align: center;
    background: var(--bg-muted);
    padding: 1.5rem;
    border-radius: 8px;
}

.cta-section h2 {
    font-size: 1.1rem;
    margin: 0 0 0.4rem;
}

.cta-section > p {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-bottom: 1rem;
}

.btn-primary {
    display: inline-block;
    padding: 0.65rem 1.5rem;
    background: var(--primary);
    color: #fff;
    font-weight: 600;
    font-size: 0.9rem;
    border-radius: 6px;
    text-decoration: none;
}

.btn-primary:hover {
    background: var(--primary-dark);
}

.cta-back {
    margin-top: 0.75rem;
    font-size: 0.85rem;
}

.cta-back a {
    color: var(--text-muted);
    text-decoration: none;
}

.cta-back a:hover {
    color: var(--primary);
}

/* =============================================================================
   MOBILE RESPONSIVE
   ============================================================================= */

@media (max-width: 700px) {
    /* Switch to card view */
    .desktop-only {
        display: none !important;
    }
    
    .mobile-only {
        display: block !important;
    }
    
    /* Tighter spacing */
    .tribunal-history-page {
        padding: 0 0.75rem 1.5rem;
    }
    
    .breadcrumb {
        padding: 0.5rem 0.75rem;
        font-size: 0.75rem;
    }
    
    .page-header {
        padding: 0.75rem 0 1rem;
    }
    
    .page-header h1 {
        font-size: 1.25rem;
    }
    
    /* Summary grid: 2x2 */
    .summary-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .stat-value {
        font-size: 1.25rem;
    }
    
    /* Risk band */
    .risk-band-banner {
        flex-wrap: wrap;
        padding: 0.6rem 0.75rem;
    }
    
    .risk-band-label {
        width: 100%;
        text-align: center;
        font-size: 0.75rem;
    }
    
    /* Outcome grid: 2x2 */
    .outcome-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    /* Enforcement: stack */
    .enforcement-grid {
        grid-template-columns: 1fr;
    }
    
    /* Category names shorter */
    .category-name {
        width: 80px;
        font-size: 0.75rem;
    }
    
    /* Notable cases */
    .notable-case {
        padding: 0.75rem;
    }
    
    .notable-quote {
        font-size: 0.8rem;
    }
    
    /* Sections */
    .section {
        margin-bottom: 1.5rem;
    }
    
    .section-title {
        font-size: 1rem;
    }
}

@media (max-width: 400px) {
    .summary-stat {
        padding: 0.75rem 0.25rem;
    }
    
    .stat-value {
        font-size: 1.1rem;
    }
    
    .stat-label {
        font-size: 0.65rem;
    }
    
    .breach-item {
        flex-wrap: wrap;
    }
    
    .breach-desc {
        width: 100%;
        order: 3;
        margin-top: 0.25rem;
    }
}
</style>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const outcomeFilter = document.getElementById('filter-outcome');
    const showAllBtn = document.getElementById('show-all-cases');
    
    // Filter functionality
    if (outcomeFilter) {
        outcomeFilter.addEventListener('change', function() {
            const outcome = this.value;
            
            // Filter table rows (desktop)
            document.querySelectorAll('.case-row').forEach(row => {
                const match = !outcome || row.dataset.outcome === outcome;
                row.style.display = match ? '' : 'none';
                row.classList.remove('hidden-row');
            });
            
            // Filter cards (mobile)
            document.querySelectorAll('.case-card').forEach(card => {
                const match = !outcome || card.dataset.outcome === outcome;
                card.style.display = match ? '' : 'none';
                card.classList.remove('hidden-card');
            });
            
            // Hide show all button when filtering
            if (showAllBtn) {
                showAllBtn.style.display = outcome ? 'none' : '';
            }
        });
    }
    
    // Show all functionality
    if (showAllBtn) {
        showAllBtn.addEventListener('click', function() {
            document.querySelectorAll('.hidden-row').forEach(row => {
                row.classList.remove('hidden-row');
            });
            document.querySelectorAll('.hidden-card').forEach(card => {
                card.classList.remove('hidden-card');
            });
            this.style.display = 'none';
        });
    }
});
</script>
{% endblock %}