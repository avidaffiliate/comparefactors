{#
Factor Profile Template v5.18.3 - Fix broken guide links
Merged: v4.2 original structure + v5 strategic features (Verdict, Postcodes, Schema)

v5.18.3 Changes:
- Fixed /guides/switching-factors/ → /guides/how-to-switch-factors-scotland/
- Removed broken /guides/request-wss/ link (page doesn't exist)
- Changed /quote/?from= → /get-quotes/?from= (consolidated quote pages)

v5.18.2 Changes:
- Pipeline now infers frequency from fee type when not in source data
- Management fees show "per year", late fees show "per incident", etc.

v5.18.1 Changes:
- Renamed fee.items to fee.details to avoid conflict with Python dict.items() method
- Fixed "builtin_function_or_method object has no element 0" error

v5.18 Changes:
- Tribunal fees now expandable on click to show individual case details
- Collapsed view shows fee type, range, frequency, and example count
- Expanded view shows each case reference with amount and link to PDF
- Chevron rotates on expand
- Single-item fees show case link inline without expand

v5.17 Changes:
- Tribunal fees now grouped by type with ranges (£30–£480 instead of individual entries)
- Shows frequency inline (e.g. "per year", "one-time")
- Shows example count (e.g. "FTS/HPC/PF/23/3699 +4 more")
- Cleaner display with fewer rows

v5.16 Changes:
- Updated HPC links to correct decisions page: /apply-tribunal/property-factors/property-factors-decisions
- Added AI caveats to Tribunal Record and Recent Decisions footers
- Added page-level AI disclaimer in site footer
- Tribunal fees: case references link to PDF or HPC decisions page (not search)
- Recent Decisions case fallback links to HPC decisions page

v5.15 Changes:
- Added "Full history →" link to internal tribunal pages (/factors/{pf}/tribunal/)
- Tribunal Record and Recent Decisions now show both internal and HPC links
- Tribunal fees now show case reference as hyperlink (to PDF or HPC search)
- Added frequency display (annual, one-time, monthly) on tribunal fees
- Removed magnifying glass icon, simplified fee row layout
- Shows all fees that pass filter (no 6 item limit)
- Added card-header-links CSS for multiple links

v5.14 Changes:
- Added "View all on HPC →" link to Recent Decisions section header
- Links to Housing & Property Chamber search for the factor

v5.13 Changes:
- WSS not available message now says "reach out to them directly to request a copy"
- Coverage section fixed: stats only show with context
- If no area names but have postcode/property count, shows appropriate message
- No longer shows "No coverage data" alongside postcode stats

v5.12 Changes:
- Tribunal fees now link to source case PDFs
- Shows search icon if no direct PDF link available
- Updated CSS for fee row with link button

v5.11 Changes:
- Removed numeric score from risk badge, now shows just band name (CLEAN, GREEN, etc.)
- Fixed severity badge colors: low (green), medium (amber), high (orange), critical (red)
- Fixed outcome badge mapping to handle more case types (Referred to Ministers = neutral gray)
- Updated At a Glance to show "Tribunal Rating" instead of score
- Updated meta descriptions to remove numeric scores
- Removed unused .risk-badge-score CSS

v5.10 Changes:
- Read Reviews now shows individual Google locations when multiple exist
- Each location shows name, rating, review count, and link
- Falls back to single aggregate link when only one location
- Added CSS for review-locations-breakdown component

v5.9 Changes:
- Removed redundant "Managed Postcode Sectors" (was duplicate of coverage areas)
- Simplified coverage display to single grid of area tags
- Added filter to strip stray quote characters from area names
- Cleaner stats display with large numbers

v5.8 Changes:
- Fixed management fee display when value is text not price (e.g. "detailed in Section 07...")
- Shows "Varies" as headline with explanatory text below for non-numeric fees
- Added .fee-note CSS for text descriptions

v5.7 Changes:
- Reviews section now links directly to platform sources (Google, Trustpilot)
- Fees section separated into WSS and Tribunal sources with clear attribution
- Added fees caveat banner about variability by property
- New CSS for review source links and fees source sections

v5.6 Changes:
- Tribunal case links now go to official PDF or HPC search (not internal pages)
- "View on HPC →" links to Housing & Property Chamber search

v5.5 Changes:
- Template now displays actual review text when available
- Falls back to "Review Locations" with links when only aggregate data exists
- Separates reviews_with_text from aggregate_reviews using Jinja filters
- New .review-snippet styles for displaying quoted review text
- Shows up to 5 reviews with text, then links to more

Required data context:
- profile: Row from v_factor_profiles view
- at_a_glance: Parsed JSON {bullets: [...], overall_sentiment: ..., summary: ...}
- wss: Row from wss table
- recent_reviews: List of reviews (with review_text for snippets)
- google_places: Dict with contact info (phone, address, place_id)
- google_locations: List of Google locations [{name, rating, review_count, place_id, address}]
- trustpilot: Dict with url
- fee_examples: List of fee examples
- fee_summary: Dict with aggregated stats
- case_fees: List of extracted fees from tribunal
- tribunal_last_5_years: Dict stats
- tribunal_full_history: Dict stats
- cases_by_year: List for trend chart
- recent_cases: List of cases
- complaint_categories: Dict
- similar_factors: List
- generated_date: Date string
#}

<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" href="/favicon-48x48.png" sizes="48x48">
    <link rel="manifest" href="/site.webmanifest">
    
    <title>{{ profile.name }} | Compare Factors Scotland</title>
    
    <meta name="description" content="{% if profile.status != 'registered' %}Historical profile for {{ profile.name }} (registration expired). {% else %}Independent profile for {{ profile.name }}. Tribunal rating: {{ profile.risk_band|default('CLEAN') }}. {% endif %}Reviews, fees, and registration status. Compare Scottish property factors.">
    <link rel="canonical" href="https://comparefactors.co.uk/factors/{{ profile.registration_number|lower }}/">

    <!-- Open Graph / Social Sharing -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://comparefactors.co.uk/factors/{{ profile.registration_number|lower }}/">
    <meta property="og:title" content="{{ profile.name }} - Property Factor Profile | Compare Factors">
    <meta property="og:description" content="{% if profile.risk_band %}{{ profile.risk_band }} tribunal rating. {% endif %}{% if profile.combined_rating %}{{ "%.1f"|format(profile.combined_rating) }}★ average review rating. {% endif %}Independent comparison data for Scottish property factors.">
    <meta property="og:image" content="https://comparefactors.co.uk/images/og-factor-profile.png">
    <meta name="twitter:card" content="summary_large_image">

    <!-- ==================== DYNAMIC SEO SCHEMA (v5 Updated) ==================== -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "RealEstateAgent",
          "@id": "https://comparefactors.co.uk/factors/{{ profile.registration_number|lower }}/#organization",
          "name": "{{ profile.name }}",
          {% if profile.registration_number %}
          "image": "https://comparefactors.co.uk/images/factors/{{ profile.registration_number|lower }}.jpg",
          {% endif %}
          "description": "Property factor profile for {{ profile.name }} ({{ profile.registration_number }}). Risk rating: {{ profile.risk_band }}. Managed properties: {{ profile.property_count }}. Services include block management, insurance administration, and repairs.",
          "url": "https://comparefactors.co.uk/factors/{{ profile.registration_number|lower }}/",
          {% if google_places and google_places.phone %}
          "telephone": "{{ google_places.phone }}",
          {% endif %}
          {% if google_places and google_places.address %}
          "address": {
            "@type": "PostalAddress",
            "streetAddress": "{{ google_places.address.split(',')[0] if ',' in google_places.address else google_places.address }}",
            "addressLocality": "{{ google_places.address.split(',')[-2].strip() if google_places.address.split(',')|length > 2 else 'Scotland' }}",
            "postalCode": "{{ google_places.address.split(',')[-1].strip() if ',' in google_places.address else '' }}",
            "addressCountry": "GB"
          },
          {% endif %}
          
          {% if profile.coverage_areas %}
          "areaServed": [
            {% for area in profile.coverage_areas.split(',')[:15] %}
            {% set clean_area = area.strip().replace('"', '').replace('&#34;', '') %}
            {"@type": "City", "name": "{{ clean_area }}"}{% if not loop.last %},{% endif %}
            {% endfor %}
          ],
          {% endif %}

          "memberOf": [
            {% if profile.tpi_member %}
            {
              "@type": "Organization",
              "name": "The Property Institute of Scotland",
              "url": "https://tpi.org.uk"
            }
            {% endif %}
          ],

          "hasOfferCatalog": {
            "@type": "OfferCatalog",
            "name": "Property Factoring Services",
            "itemListElement": [
              { "@type": "Offer", "itemOffered": { "@type": "Service", "name": "Block Management" } },
              { "@type": "Offer", "itemOffered": { "@type": "Service", "name": "Building Insurance Administration" } },
              { "@type": "Offer", "itemOffered": { "@type": "Service", "name": "Emergency Repairs" } }
            ]
          },

          "priceRange": "££",

          {% set total_reviews = (profile.google_review_count|default(0)) + (profile.trustpilot_review_count|default(0)) %}
          {% if profile.combined_rating and total_reviews > 0 %}
          "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "{{ "%.1f"|format(profile.combined_rating) }}",
            "reviewCount": "{{ total_reviews }}",
            "bestRating": "5",
            "worstRating": "1"
          },
          {% endif %}

          "knowsAbout": "Property Factoring Act (Scotland) 2011"
        },
        
        {
          "@type": "BreadcrumbList",
          "itemListElement": [
            { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://comparefactors.co.uk/" },
            { "@type": "ListItem", "position": 2, "name": "Factors", "item": "https://comparefactors.co.uk/factors/" },
            { "@type": "ListItem", "position": 3, "name": "{{ profile.name }}", "item": "https://comparefactors.co.uk/factors/{{ profile.registration_number|lower }}/" }
          ]
        },

        {
          "@type": "FAQPage",
          "mainEntity": [
            {
              "@type": "Question",
              "name": "Has {{ profile.name }} had any tribunal cases?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "{% if tribunal_full_history.case_count > 0 %}Yes, {{ profile.name }} has had {{ tribunal_full_history.case_count }} tribunal cases on record{% if tribunal_full_history.first_case_year %} since {{ tribunal_full_history.first_case_year }}{% endif %}. {% if tribunal_last_5_years.case_count > 0 %}In the last 5 years, they've had {{ tribunal_last_5_years.case_count }} cases with {{ tribunal_last_5_years.complaints_upheld_pct|default(0)|int }}% of complaints upheld.{% endif %}{% else %}No, {{ profile.name }} has no tribunal cases on record with the Housing & Property Chamber.{% endif %}"
              }
            },
            {
                "@type": "Question",
                "name": "How much does {{ profile.name }} charge?",
                "acceptedAnswer": {
                  "@type": "Answer",
                  "text": "{% if wss.management_fee_amount %}According to their Written Statement of Services, the standard management fee is £{{ wss.management_fee_amount }} {% if wss.management_fee_frequency %}({{ wss.management_fee_frequency }}){% endif %}. Fees vary by development.{% else %}Fee information for {{ profile.name }} is not currently publicly available in our database. Factors typically charge between £120 and £350 per year.{% endif %}"
                }
            },
            {
              "@type": "Question",
              "name": "How do I make a complaint about {{ profile.name }}?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "First, raise your complaint directly with {{ profile.name }} using their formal complaints procedure (required by law to be in their Written Statement of Services). If unresolved after 8 weeks, you can apply to the Housing & Property Chamber. Visit housingandpropertychamber.scot to start an application."
              }
            }
            {% if profile.status == 'registered' and profile.factor_type not in ['RSL', 'Housing Association', 'Local Authority'] %}
            ,{
                "@type": "Question",
                "name": "How do I switch away from {{ profile.name }}?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "To change property factors, you'll need a majority vote from property owners in your development (typically at an AGM or EGM). The new factor must be registered with the Scottish Property Factor Register. Our switching guide explains the full process step-by-step."
                }
            }
            {% endif %}
          ]
        }
      ]
    }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,600;0,9..144,700;1,9..144,400&family=Source+Sans+3:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
    /* ==================== CSS VARIABLES ==================== */
    :root {
        /* Navy scale - primary dark colors */
        --navy-950: #0a0f1a;
        --navy-900: #0f172a;
        --navy-800: #1e293b;
        --navy-700: #334155;
        
        /* Slate scale - neutral grays */
        --slate-600: #475569;
        --slate-500: #64748b;
        --slate-400: #94a3b8;
        --slate-300: #cbd5e1;
        --slate-200: #e2e8f0;
        --slate-100: #f1f5f9;
        --slate-50: #f8fafc;
        --white: #ffffff;
        
        /* Status colors */
        --red-700: #b91c1c;
        --red-600: #dc2626;
        --red-100: #fee2e2;
        --red-50: #fef2f2;
        
        --orange-600: #ea580c;
        --orange-100: #ffedd5;
        
        --amber-600: #d97706;
        --amber-100: #fef3c7;
        
        --green-700: #15803d;
        --green-600: #16a34a;
        --green-100: #dcfce7;
        --green-50: #f0fdf4;
        
        --emerald-700: #047857;
        --emerald-600: #059669;
        --emerald-100: #d1fae5;
        
        --blue-700: #1d4ed8;
        --blue-600: #2563eb;
        --blue-100: #dbeafe;
        
        --indigo-600: #4f46e5;
        --indigo-100: #e0e7ff;
        --indigo-50: #eef2ff;
        
        /* Grey for expired/inactive */
        --gray-600: #4b5563;
        --gray-500: #6b7280;
        --gray-100: #f3f4f6;
        
        /* Typography */
        --font-display: 'Fraunces', Georgia, serif;
        --font-body: 'Source Sans 3', -apple-system, BlinkMacSystemFont, sans-serif;
        
        /* Spacing */
        --space-xs: 0.25rem;
        --space-sm: 0.5rem;
        --space-md: 1rem;
        --space-lg: 1.5rem;
        --space-xl: 2rem;
        --space-2xl: 3rem;
        
        /* Text sizes */
        --text-xs: 0.75rem;
        --text-sm: 0.875rem;
        --text-base: 1rem;
        --text-lg: 1.125rem;
        --text-xl: 1.25rem;
        --text-2xl: 1.5rem;
        --text-3xl: 1.875rem;
        
        /* Shadows */
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
        --shadow-md: 0 1px 3px rgba(0, 0, 0, 0.04), 0 4px 12px rgba(0, 0, 0, 0.04);
        --shadow-lg: 0 4px 12px rgba(0,0,0,0.1);
        
        /* Borders */
        --radius-sm: 8px;
        --radius-md: 10px;
        --radius-lg: 16px;
    }
    
    /* ==================== RESET & BASE ==================== */
    *, *::before, *::after { box-sizing: border-box; }
    
    body {
        font-family: var(--font-body);
        font-size: var(--text-base);
        line-height: 1.6;
        color: var(--navy-800);
        background: var(--slate-50);
        margin: 0;
        padding: 0;
        -webkit-font-smoothing: antialiased;
    }
    
    h1, h2, h3, h4 { 
        font-family: var(--font-display);
        line-height: 1.3; 
        margin: 0;
    }
    
    a { color: var(--blue-600); text-decoration: none; }
    a:hover { text-decoration: underline; }
    
    /* ==================== LAYOUT ==================== */
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 24px;
    }
    
    .profile-layout {
        display: grid;
        grid-template-columns: 1fr 340px;
        gap: var(--space-xl);
        align-items: start;
        padding: var(--space-xl) 0;
    }
    
    @media (max-width: 968px) {
        .profile-layout {
            grid-template-columns: 1fr;
        }
        .sidebar { order: 2; }
        .main-content { order: 1; }
    }
    
    /* ==================== HEADER ==================== */
    .site-header {
        background: var(--white);
        border-bottom: 1px solid var(--slate-200);
        position: sticky;
        top: 0;
        z-index: 100;
    }
    
    .header-inner {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 68px;
    }
    
    .logo {
        font-family: var(--font-display);
        font-size: 1.35rem;
        font-weight: 600;
        color: var(--navy-900);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .logo:hover { text-decoration: none; }
    
    .logo-mark {
        width: 36px;
        height: 36px;
        background: var(--navy-900);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--white);
        font-weight: 700;
        font-size: 1.1rem;
        letter-spacing: -0.5px;
    }
    
    .nav {
        display: flex;
        align-items: center;
        gap: 32px;
    }
    .nav-link {
        color: var(--slate-600);
        font-weight: 500;
        font-size: 0.95rem;
        transition: color 0.15s;
        text-decoration: none;
    }
    .nav-link:hover { color: var(--navy-900); text-decoration: none; }
    
    .nav-cta {
        background: var(--navy-900);
        color: var(--white) !important;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
        transition: background 0.15s;
        text-decoration: none;
    }
    .nav-cta:hover { background: var(--navy-800); text-decoration: none; }
    
    /* Mobile Menu */
    .burger {
        display: none;
        flex-direction: column;
        justify-content: center;
        gap: 5px;
        width: 28px;
        height: 28px;
        background: none;
        border: none;
        cursor: pointer;
        padding: 0;
    }

    .burger span {
        display: block;
        width: 100%;
        height: 2px;
        background: var(--navy-900);
        border-radius: 2px;
        transition: all 0.3s;
    }

    .burger.active span:nth-child(1) {
        transform: rotate(45deg) translate(5px, 5px);
    }

    .burger.active span:nth-child(2) {
        opacity: 0;
    }

    .burger.active span:nth-child(3) {
        transform: rotate(-45deg) translate(5px, -5px);
    }

    .mobile-nav {
        display: none;
        position: absolute;
        top: 68px;
        left: 0;
        right: 0;
        background: var(--white);
        border-bottom: 1px solid var(--slate-200);
        padding: 16px 24px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .mobile-nav.active {
        display: block;
    }

    .mobile-nav a {
        display: block;
        padding: 12px 0;
        color: var(--slate-600);
        text-decoration: none;
        font-size: 1rem;
        font-weight: 500;
        border-bottom: 1px solid var(--slate-100);
    }

    .mobile-nav a:last-child {
        border-bottom: none;
    }

    .mobile-nav a:hover {
        color: var(--navy-900);
    }

    .mobile-nav .nav-cta {
        display: inline-block;
        margin-top: 12px;
        text-align: center;
    }
    
    @media (max-width: 768px) {
        .nav { display: none; }
        .burger {
            display: flex;
        }
    }
    
    /* ==================== BREADCRUMB ==================== */
    .breadcrumb {
        padding: var(--space-md) 0;
        font-size: var(--text-sm);
        color: var(--slate-500);
    }
    .breadcrumb a { color: var(--slate-500); }
    .breadcrumb a:hover { color: var(--navy-900); }
    .breadcrumb span { margin: 0 var(--space-sm); }
    
    /* ==================== ALERT BANNERS ==================== */
    .alert-banner {
        display: flex;
        align-items: flex-start;
        gap: var(--space-md);
        padding: var(--space-md) var(--space-lg);
        border-radius: var(--radius-md);
        margin-bottom: var(--space-md);
        font-size: var(--text-sm);
        line-height: 1.5;
    }
    
    .alert-banner svg {
        flex-shrink: 0;
        margin-top: 2px;
    }
    
    .alert-banner-content {
        flex: 1;
    }
    
    .alert-banner-title {
        font-weight: 600;
        margin-bottom: 2px;
    }
    
    .alert-banner--expired {
        background: var(--gray-100);
        border: 1px solid var(--slate-300);
        color: var(--gray-600);
    }
    
    .alert-banner--info {
        background: var(--blue-100);
        border: 1px solid #93c5fd;
        color: var(--blue-700);
    }
    
    /* ==================== PROFILE HEADER ==================== */
    .profile-header {
        background: var(--white);
        border-radius: var(--radius-lg);
        padding: var(--space-xl) 28px;
        margin-bottom: var(--space-lg);
        box-shadow: var(--shadow-md);
        border: 1px solid var(--slate-200);
    }
    
    .profile-header-top {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: var(--space-lg);
        margin-bottom: var(--space-lg);
    }
    
    .profile-identity h1 {
        font-size: var(--text-2xl);
        font-weight: 700;
        color: var(--navy-950);
        margin-bottom: var(--space-xs);
    }
    
    .profile-meta {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-sm) var(--space-md);
        font-size: var(--text-sm);
        color: var(--slate-500);
    }
    
    .profile-meta-item {
        display: flex;
        align-items: center;
        gap: var(--space-xs);
    }
    
    /* Risk Badge */
    /* Dynamic classes based on band */
    {% set band = profile.risk_band|default('CLEAN') %}
    {% set band_class = 'expired' if profile.status != 'registered' else {'CLEAN': 'clean', 'GREEN': 'green', 'AMBER': 'amber', 'ORANGE': 'orange', 'RED': 'red'}.get(band, 'clean') %}
    {% set band_lower = band|lower %}
    
    .risk-badge {
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        padding: var(--space-sm) var(--space-md);
        border-radius: var(--radius-sm);
        font-weight: 600;
        text-align: center;
        min-width: 100px;
    }
    
    .risk-badge-main {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.03em;
    }
    
    .risk-badge-reason {
        font-size: var(--text-xs);
        font-weight: 500;
        opacity: 0.85;
        margin-top: 2px;
        text-transform: none;
        letter-spacing: 0;
    }
    
    .risk-badge.clean, .risk-badge--clean { background: var(--emerald-100); color: var(--emerald-700); }
    .risk-badge.green, .risk-badge--green { background: var(--green-100); color: var(--green-700); }
    .risk-badge.amber, .risk-badge--amber { background: var(--amber-100); color: var(--amber-600); }
    .risk-badge.orange, .risk-badge--orange { background: var(--orange-100); color: var(--orange-600); }
    .risk-badge.red, .risk-badge--red { background: var(--red-100); color: var(--red-700); }
    .risk-badge.expired, .risk-badge--expired { background: var(--gray-100); color: var(--gray-500); }
    
    /* ==================== VERDICT BOX (NEW) ==================== */
    .verdict-box {
        background: var(--slate-50);
        border: 1px solid var(--slate-200);
        border-radius: var(--radius-md);
        padding: var(--space-lg);
        margin-bottom: var(--space-lg);
        position: relative;
    }

    .verdict-box::before {
        content: '';
        position: absolute;
        left: 0;
        top: 20px;
        bottom: 20px;
        width: 4px;
        background: var(--navy-700);
        border-radius: 0 4px 4px 0;
    }
    /* Dynamic Verdict Colors */
    .verdict-box.red::before { background: var(--red-600); }
    .verdict-box.orange::before { background: var(--orange-600); }
    .verdict-box.amber::before { background: var(--amber-600); }
    .verdict-box.green::before { background: var(--green-600); }
    .verdict-box.clean::before { background: var(--emerald-600); }
    
    .verdict-header {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        font-family: var(--font-display);
        font-weight: 600;
        font-size: 1.1rem;
        color: var(--navy-900);
        margin-bottom: var(--space-sm);
    }
    
    .verdict-text {
        font-size: 0.95rem;
        color: var(--slate-600);
        margin: 0;
        line-height: 1.6;
    }
    
    .verdict-highlight {
        font-weight: 600;
        color: var(--navy-800);
    }
    
    /* ==================== TOOLTIPS ==================== */
    .tooltip-trigger {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 16px;
        height: 16px;
        background: var(--slate-200);
        color: var(--slate-500);
        border-radius: 50%;
        font-size: 10px;
        font-weight: 600;
        cursor: help;
        position: relative;
        border: none;
        padding: 0;
        vertical-align: middle;
        margin-left: 4px;
    }
    
    .tooltip-content {
        position: absolute;
        bottom: calc(100% + 8px);
        left: 50%;
        transform: translateX(-50%);
        background: var(--navy-900);
        color: white;
        padding: 8px 12px;
        border-radius: var(--radius-sm);
        font-size: var(--text-xs);
        font-weight: 400;
        line-height: 1.4;
        white-space: normal;
        width: 220px;
        text-align: left;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.15s, visibility 0.15s;
        z-index: 100;
        pointer-events: none;
    }
    
    .tooltip-content::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 6px solid transparent;
        border-top-color: var(--navy-900);
    }
    
    .tooltip-trigger:hover .tooltip-content,
    .tooltip-trigger:focus .tooltip-content {
        opacity: 1;
        visibility: visible;
    }
    
    /* ==================== AT A GLANCE ==================== */
    .at-a-glance {
        background: linear-gradient(135deg, var(--slate-50) 0%, var(--slate-100) 100%);
        border: 1px solid var(--slate-200);
        border-radius: var(--radius-lg);
        padding: var(--space-lg);
    }
    
    .glance-title {
        font-family: var(--font-display);
        font-size: var(--text-lg);
        font-weight: 600;
        color: var(--navy-900);
        margin-bottom: var(--space-md);
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }
    
    /* Key Stats Grid */
    .key-stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: var(--space-md);
        margin-bottom: var(--space-lg);
        padding-bottom: var(--space-lg);
        border-bottom: 1px solid var(--slate-200);
    }
    
    @media (max-width: 640px) {
        .key-stats { grid-template-columns: repeat(2, 1fr); }
    }
    
    .key-stat {
        text-align: center;
    }
    
    .key-stat-value {
        font-family: var(--font-display);
        font-size: var(--text-xl);
        font-weight: 700;
        color: var(--navy-800);
    }
    .key-stat-value.clean, .key-stat-value.green { color: var(--green-600); }
    .key-stat-value.amber { color: var(--amber-600); }
    .key-stat-value.orange { color: var(--orange-600); }
    .key-stat-value.red { color: var(--red-600); }
    .key-stat-value.muted { color: var(--slate-400); }
    
    .key-stat-label {
        font-size: var(--text-xs);
        color: var(--slate-500);
        margin-top: var(--space-xs);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
    }
    
    .key-stat-benchmark {
        font-size: 10px;
        color: var(--slate-400);
        margin-top: 2px;
    }
    
    /* Glance Grid (insights) */
    .glance-grid {
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
    }
    
    .glance-item {
        display: flex;
        align-items: flex-start;
        gap: var(--space-sm);
        font-size: var(--text-sm);
        color: var(--slate-600);
        padding: var(--space-sm) 0;
    }
    
    .glance-icon {
        flex-shrink: 0;
        width: 18px;
        height: 18px;
        margin-top: 2px;
    }
    .glance-icon.green { color: var(--green-600); }
    .glance-icon.amber { color: var(--amber-600); }
    .glance-icon.red { color: var(--red-600); }
    .glance-icon.muted { color: var(--slate-400); }
    
    /* ==================== CARDS ==================== */
    .card {
        background: var(--white);
        border: 1px solid var(--slate-200);
        border-radius: var(--radius-lg);
        margin-bottom: var(--space-lg);
        overflow: hidden;
        box-shadow: var(--shadow-sm);
    }
    
    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-lg) var(--space-lg) 0;
    }
    
    .card-title {
        font-size: var(--text-lg);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }
    
    .card-link {
        font-size: var(--text-sm);
        font-weight: 500;
    }
    
    .card-header-links {
        display: flex;
        gap: var(--space-md);
        align-items: center;
    }
    
    .card-header-links .card-link {
        white-space: nowrap;
    }
    
    .card-body {
        padding: var(--space-lg);
    }
    
    .card-footer {
        padding: var(--space-md) var(--space-lg);
        background: var(--slate-50);
        border-top: 1px solid var(--slate-100);
        font-size: var(--text-xs);
        color: var(--slate-500);
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: var(--space-md);
    }
    
    .card-footer-timestamp {
        white-space: nowrap;
    }
    
    /* Empty state */
    .empty-state {
        text-align: center;
        padding: var(--space-xl);
        color: var(--slate-500);
    }
    
    .empty-state-icon {
        width: 48px;
        height: 48px;
        margin: 0 auto var(--space-md);
        color: var(--slate-300);
    }
    
    /* ==================== REVIEWS ==================== */
    .review-platforms {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-md);
        margin-bottom: var(--space-lg);
    }
    
    @media (max-width: 480px) {
        .review-platforms { grid-template-columns: 1fr; }
    }
    
    .review-platform {
        display: flex;
        align-items: flex-start;
        gap: var(--space-md);
        padding: var(--space-md);
        background: var(--slate-50);
        border-radius: var(--radius-md);
    }
    
    .platform-logo {
        width: 40px;
        height: 40px;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1.2rem;
        flex-shrink: 0;
    }
    
    .platform-logo.google {
        background: #fff;
        border: 1px solid var(--slate-200);
        color: #4285f4;
    }
    
    .platform-logo.trustpilot {
        background: #00b67a;
        color: white;
    }
    
    .platform-rating {
        font-family: var(--font-display);
        font-size: var(--text-xl);
        font-weight: 700;
        color: var(--navy-800);
    }
    
    .platform-stars {
        color: #fbbf24;
        font-size: var(--text-sm);
        letter-spacing: -1px;
    }
    
    .platform-count {
        font-size: var(--text-xs);
        color: var(--slate-500);
    }
    
    .platform-empty {
        font-size: var(--text-sm);
        color: var(--slate-400);
        font-style: italic;
    }
    
    .rating-explanation {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        padding: var(--space-sm) var(--space-md);
        background: var(--blue-100);
        border-radius: var(--radius-sm);
        font-size: var(--text-sm);
        color: var(--blue-700);
        margin-bottom: var(--space-md);
    }
    
    .review-snippets {
        display: flex;
        flex-direction: column;
        gap: var(--space-md);
    }
    
    .review-snippet {
        padding: var(--space-md);
        background: var(--slate-50);
        border-radius: var(--radius-md);
        border-left: 3px solid var(--slate-300);
    }
    
    .review-snippet-text {
        font-size: var(--text-sm);
        color: var(--slate-600);
        font-style: italic;
        margin-bottom: var(--space-sm);
    }
    
    .review-snippet-meta {
        display: flex;
        justify-content: space-between;
        font-size: var(--text-xs);
        color: var(--slate-500);
    }
    
    /* Review Snippets - actual review text */
    .review-snippets {
        margin-bottom: var(--space-lg);
    }
    
    .review-snippets-title {
        font-size: var(--text-sm);
        font-weight: 600;
        color: var(--slate-700);
        margin-bottom: var(--space-md);
    }
    
    .review-snippet {
        padding: var(--space-md);
        background: var(--slate-50);
        border-radius: var(--radius-md);
        border-left: 3px solid var(--slate-300);
        margin-bottom: var(--space-sm);
    }
    
    .review-snippet-header {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        margin-bottom: var(--space-sm);
    }
    
    .review-rating {
        font-weight: 700;
        color: var(--amber-600);
        font-size: var(--text-sm);
    }
    
    .review-snippet-text {
        font-size: var(--text-sm);
        color: var(--slate-700);
        line-height: 1.6;
        font-style: italic;
        margin-bottom: var(--space-sm);
    }
    
    .review-snippet-meta {
        display: flex;
        justify-content: space-between;
        font-size: var(--text-xs);
        color: var(--slate-500);
    }
    
    .review-author {
        font-weight: 500;
    }
    
    /* Review Locations - linked review sources */
    .review-locations {
        margin-top: var(--space-lg);
        padding-top: var(--space-lg);
        border-top: 1px solid var(--slate-200);
    }
    
    .review-locations-title {
        font-size: var(--text-sm);
        font-weight: 600;
        color: var(--slate-700);
        margin-bottom: var(--space-md);
    }
    
    .review-locations-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
    }
    
    .review-location-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-sm) var(--space-md);
        background: var(--slate-50);
        border-radius: var(--radius-md);
        gap: var(--space-md);
    }
    
    .review-location-info {
        display: flex;
        align-items: center;
        gap: var(--space-md);
        flex-wrap: wrap;
    }
    
    .review-location-rating {
        font-weight: 700;
        color: var(--navy-800);
        font-size: var(--text-sm);
    }
    
    .review-location-count {
        color: var(--slate-500);
        font-size: var(--text-sm);
    }
    
    .read-reviews-link {
        font-size: var(--text-sm);
        font-weight: 500;
        color: var(--blue-600);
        text-decoration: none;
        white-space: nowrap;
    }
    
    .read-reviews-link:hover {
        text-decoration: underline;
    }
    
    .platform-badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 8px;
        border-radius: var(--radius-sm);
        font-size: var(--text-xs);
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .platform-badge--google {
        background: #f1f3f4;
        color: #4285f4;
    }
    
    .platform-badge--trustpilot {
        background: #00b67a;
        color: white;
    }
    
    @media (max-width: 480px) {
        .review-location-item {
            flex-direction: column;
            align-items: flex-start;
            gap: var(--space-sm);
        }
        
        .review-location-link {
            width: 100%;
        }
        
        .read-reviews-link {
            display: block;
            text-align: center;
            padding: var(--space-xs) var(--space-sm);
            background: var(--blue-50);
            border-radius: var(--radius-sm);
        }
    }
    
    /* ==================== TRIBUNAL ==================== */
    .tribunal-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-lg);
        margin-bottom: var(--space-lg);
    }
    
    @media (max-width: 640px) {
        .tribunal-grid { grid-template-columns: 1fr; }
    }
    
    .tribunal-period {
        background: var(--slate-50);
        padding: var(--space-md);
        border-radius: var(--radius-md);
    }
    
    .tribunal-period-title {
        font-weight: 600;
        font-size: var(--text-sm);
        color: var(--navy-800);
        margin-bottom: var(--space-md);
        padding-bottom: var(--space-sm);
        border-bottom: 1px solid var(--slate-200);
    }
    
    .tribunal-stat-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-xs) 0;
        font-size: var(--text-sm);
    }
    
    .tribunal-stat-label {
        color: var(--slate-500);
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .tribunal-stat-value {
        font-weight: 600;
        color: var(--navy-800);
    }
    .tribunal-stat-value.red { color: var(--red-600); }
    
    .benchmark-indicator {
        font-size: var(--text-xs);
        font-weight: 400;
        color: var(--slate-400);
        margin-left: 4px;
    }
    
    /* Complaint categories */
    .complaint-categories {
        margin-bottom: var(--space-lg);
        padding: var(--space-md);
        background: var(--slate-50);
        border-radius: var(--radius-md);
    }
    
    .complaint-categories-title {
        font-size: var(--text-sm);
        font-weight: 600;
        color: var(--navy-800);
        margin-bottom: var(--space-md);
    }
    
    .complaint-bar-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
    }
    
    .complaint-bar-item {
        display: grid;
        grid-template-columns: 120px 1fr 40px;
        align-items: center;
        gap: var(--space-sm);
        font-size: var(--text-sm);
    }
    
    .complaint-bar-label {
        color: var(--slate-600);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .complaint-bar-track {
        height: 8px;
        background: var(--slate-200);
        border-radius: 4px;
        overflow: hidden;
    }
    
    .complaint-bar-fill {
        height: 100%;
        background: var(--amber-600);
        border-radius: 4px;
    }
    
    .complaint-bar-pct {
        font-weight: 600;
        color: var(--slate-500);
        text-align: right;
    }
    
    /* Trend chart */
    .tribunal-trend {
        margin-top: var(--space-md);
    }
    
    .trend-title {
        font-size: var(--text-sm);
        font-weight: 600;
        color: var(--navy-800);
        margin-bottom: var(--space-sm);
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }
    
    .trend-context {
        font-size: var(--text-xs);
        color: var(--slate-500);
        margin-bottom: var(--space-md);
    }
    
    .trend-chart-wrapper {
        display: flex;
        gap: var(--space-sm);
    }
    
    .trend-y-axis {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        font-size: 10px;
        color: var(--slate-400);
        text-align: right;
        padding: 4px 0 20px;
        width: 24px;
    }
    
    .trend-chart {
        flex: 1;
        display: flex;
        align-items: flex-end;
        gap: 4px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--slate-200);
        min-height: 100px;
    }
    
    .trend-bar-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2px;
    }
    
    .trend-bar-wrapper.highlight .trend-bar {
        background: var(--red-600);
    }
    
    .trend-bar-value {
        font-size: 10px;
        font-weight: 600;
        color: var(--slate-500);
    }
    
    .trend-bar {
        width: 100%;
        max-width: 32px;
        background: var(--blue-600);
        border-radius: 2px 2px 0 0;
        min-height: 4px;
    }
    
    .trend-bar.pfeo {
        background: var(--red-600);
    }
    
    .trend-label {
        font-size: 10px;
        color: var(--slate-500);
        margin-top: var(--space-xs);
    }
    /* ==================== CASE CARDS ==================== */
    .cases-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-md);
    }
    
    .case-card {
        padding: var(--space-md);
        background: var(--slate-50);
        border-radius: var(--radius-md);
        border: 1px solid var(--slate-100);
    }
    
    .case-card.hidden {
        display: none;
    }
    
    .case-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: var(--space-md);
        margin-bottom: var(--space-sm);
    }
    
    .case-ref {
        font-weight: 600;
        font-size: var(--text-sm);
        color: var(--navy-800);
    }
    
    .case-date {
        font-size: var(--text-xs);
        color: var(--slate-500);
    }
    
    .case-badges {
        display: flex;
        gap: var(--space-xs);
        flex-wrap: wrap;
    }
    
    .outcome-badge {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        border-radius: var(--radius-sm);
        font-size: var(--text-xs);
        font-weight: 600;
    }
    
    .outcome-badge--upheld { background: var(--red-100); color: var(--red-700); }
    .outcome-badge--partial { background: var(--amber-100); color: var(--amber-600); }
    .outcome-badge--dismissed { background: var(--green-100); color: var(--green-700); }
    .outcome-badge--withdrawn { background: var(--slate-100); color: var(--slate-600); }
    .outcome-badge--other { background: var(--slate-100); color: var(--slate-600); }
    
    .severity-badge {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        border-radius: var(--radius-sm);
        font-size: var(--text-xs);
        font-weight: 600;
    }
    
    .severity-badge--low { background: var(--green-100); color: var(--green-700); }
    .severity-badge--medium { background: var(--amber-100); color: var(--amber-700); }
    .severity-badge--high { background: var(--orange-100); color: var(--orange-700); }
    .severity-badge--critical { background: var(--red-100); color: var(--red-700); }
    
    .case-summary {
        font-size: var(--text-sm);
        color: var(--slate-600);
        margin-bottom: var(--space-sm);
    }
    
    .case-quote {
        font-size: var(--text-sm);
        font-style: italic;
        color: var(--slate-500);
        padding-left: var(--space-md);
        border-left: 2px solid var(--slate-300);
        margin-bottom: var(--space-sm);
    }
    
    .case-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: var(--text-xs);
        color: var(--slate-500);
    }
    
    .case-meta {
        display: flex;
        gap: var(--space-md);
    }
    
    .pfeo-indicator {
        font-size: var(--text-xs);
        font-weight: 600;
        color: var(--amber-600);
    }
    
    .case-links {
        display: flex;
        gap: var(--space-sm);
        margin-left: auto;
    }
    
    .case-link {
        font-size: var(--text-xs);
        font-weight: 500;
        color: var(--blue-600);
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }
    
    .cases-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-sm);
        padding: var(--space-sm) var(--space-md);
        background: var(--white);
        border: 1px solid var(--slate-200);
        border-radius: var(--radius-sm);
        font-size: var(--text-sm);
        font-weight: 500;
        color: var(--slate-600);
        cursor: pointer;
        margin-top: var(--space-md);
        width: 100%;
    }
    
    .cases-toggle:hover {
        background: var(--slate-50);
    }
    
    /* ==================== FEES ==================== */
    .fee-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: var(--space-md);
        margin-bottom: var(--space-md);
    }
    
    @media (max-width: 640px) {
        .fee-grid { grid-template-columns: repeat(2, 1fr); }
    }
    
    .fee-item {
        text-align: center;
        padding: var(--space-md);
        background: var(--slate-50);
        border-radius: var(--radius-md);
    }
    
    .fee-value {
        font-family: var(--font-display);
        font-size: var(--text-xl);
        font-weight: 700;
        color: var(--navy-800);
    }
    .fee-value.red { color: var(--red-600); }
    
    .fee-label {
        font-size: var(--text-xs);
        color: var(--slate-500);
        margin-top: var(--space-xs);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-xs);
    }
    
    .fee-benchmark {
        font-size: 10px;
        color: var(--slate-400);
        margin-top: 2px;
    }
    
    .fee-note {
        font-size: 11px;
        color: var(--slate-500);
        margin-top: 4px;
        line-height: 1.3;
        font-style: italic;
    }
    
    /* Fees Caveat Banner */
    .fees-caveat {
        display: flex;
        gap: var(--space-sm);
        padding: var(--space-md);
        background: var(--amber-50);
        border: 1px solid var(--amber-200);
        border-radius: var(--radius-md);
        margin-bottom: var(--space-lg);
        color: var(--amber-800);
        font-size: var(--text-sm);
    }
    
    .fees-caveat svg {
        flex-shrink: 0;
        color: var(--amber-500);
    }
    
    .fees-caveat p {
        margin: 0;
    }
    
    /* Fees Source Sections */
    .fees-source-section {
        margin-bottom: var(--space-lg);
    }
    
    .fees-source-section--separated {
        padding-top: var(--space-lg);
        border-top: 1px solid var(--slate-200);
    }
    
    .fees-source-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-md);
    }
    
    .fees-source-header h4 {
        margin: 0;
        font-size: var(--text-sm);
        font-weight: 600;
        color: var(--navy-800);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .fees-source-link {
        font-size: var(--text-sm);
        color: var(--blue-600);
        text-decoration: none;
    }
    
    .fees-source-link:hover {
        text-decoration: underline;
    }
    
    .fees-context {
        font-size: var(--text-sm);
        color: var(--slate-500);
        margin-bottom: var(--space-md);
        font-style: italic;
    }
    
    .tribunal-fees-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-xs);
    }
    
    .tribunal-fee-group {
        background: var(--slate-50);
        border-radius: var(--radius-sm);
        overflow: hidden;
    }
    
    .tribunal-fee-group.expandable .tribunal-fee-header {
        cursor: pointer;
    }
    
    .tribunal-fee-group.expandable .tribunal-fee-header:hover {
        background: var(--slate-100);
    }
    
    .tribunal-fee-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-sm) var(--space-md);
        font-size: var(--text-sm);
        gap: var(--space-md);
    }
    
    .tribunal-fee-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
        min-width: 0;
    }
    
    .tribunal-fee-type {
        color: var(--slate-700);
        font-weight: 500;
    }
    
    .tribunal-fee-count {
        font-size: var(--text-xs);
        color: var(--slate-500);
    }
    
    .tribunal-fee-details {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        flex-shrink: 0;
    }
    
    .tribunal-fee-amount {
        font-weight: 600;
        color: var(--navy-800);
    }
    
    .tribunal-fee-frequency {
        font-size: var(--text-xs);
        color: var(--slate-500);
        background: var(--slate-200);
        padding: 2px 6px;
        border-radius: var(--radius-sm);
    }
    
    .tribunal-fee-chevron {
        color: var(--slate-400);
        transition: transform 0.2s;
        flex-shrink: 0;
    }
    
    .tribunal-fee-group.expanded .tribunal-fee-chevron {
        transform: rotate(180deg);
    }
    
    .tribunal-fee-details-list {
        display: none;
        border-top: 1px solid var(--slate-200);
        background: var(--white);
    }
    
    .tribunal-fee-group.expanded .tribunal-fee-details-list {
        display: block;
    }
    
    .tribunal-fee-item-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-sm) var(--space-md);
        font-size: var(--text-sm);
        border-bottom: 1px solid var(--slate-100);
    }
    
    .tribunal-fee-item-row:last-child {
        border-bottom: none;
    }
    
    .tribunal-fee-case {
        font-size: var(--text-xs);
        color: var(--blue-600);
        text-decoration: none;
    }
    
    .tribunal-fee-case:hover {
        text-decoration: underline;
    }
    
    .tribunal-fee-item-details {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }
    
    .tribunal-fee-item-amount {
        font-weight: 500;
        color: var(--slate-700);
        min-width: 70px;
        text-align: right;
    }
    
    .tribunal-fee-item-freq {
        font-size: var(--text-xs);
        color: var(--slate-600);
        background: var(--slate-100);
        padding: 2px 8px;
        border-radius: var(--radius-sm);
        min-width: 65px;
        text-align: center;
    }
    
    .tribunal-fee-single-case {
        padding: 0 var(--space-md) var(--space-sm);
    }
    
    .fees-source-attribution {
        margin-top: var(--space-md);
        padding-top: var(--space-sm);
        border-top: 1px dashed var(--slate-200);
        font-size: var(--text-xs);
        color: var(--slate-400);
    }
    
    /* ==================== REVIEW SOURCES ==================== */
    .review-sources {
        margin-top: var(--space-lg);
        padding-top: var(--space-lg);
        border-top: 1px solid var(--slate-200);
    }
    
    .review-sources-title {
        font-size: var(--text-sm);
        font-weight: 600;
        color: var(--navy-800);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin: 0 0 var(--space-md) 0;
    }
    
    .review-sources-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
    }
    
    .review-source-link {
        display: flex;
        align-items: center;
        gap: var(--space-md);
        padding: var(--space-md);
        background: var(--slate-50);
        border: 1px solid var(--slate-200);
        border-radius: var(--radius-md);
        text-decoration: none;
        transition: all 0.2s ease;
    }
    
    .review-source-link:hover {
        background: var(--white);
        border-color: var(--slate-300);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }
    
    .review-source-link--google svg { color: #4285F4; }
    .review-source-link--trustpilot svg { color: #00B67A; }
    
    .review-source-text {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 2px;
    }
    
    .review-source-platform {
        font-weight: 600;
        color: var(--navy-800);
        font-size: var(--text-base);
    }
    
    .review-source-count {
        font-size: var(--text-sm);
        color: var(--slate-500);
    }
    
    .review-source-arrow {
        color: var(--slate-400);
        flex-shrink: 0;
    }
    
    .review-source-link:hover .review-source-arrow {
        color: var(--blue-600);
    }
    
    /* Review Locations Breakdown (multiple Google locations) */
    .review-locations-breakdown {
        background: var(--slate-50);
        border: 1px solid var(--slate-200);
        border-radius: var(--radius-md);
        overflow: hidden;
    }
    
    .review-locations-header {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        padding: var(--space-md);
        background: var(--white);
        border-bottom: 1px solid var(--slate-200);
    }
    
    .platform-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        border-radius: var(--radius-sm);
        flex-shrink: 0;
    }
    
    .platform-icon--google {
        background: #E8F0FE;
        color: #4285F4;
    }
    
    .review-locations-summary {
        font-weight: 600;
        color: var(--navy-800);
        font-size: var(--text-sm);
    }
    
    .review-locations-list {
        display: flex;
        flex-direction: column;
    }
    
    .review-location-row {
        display: flex;
        align-items: center;
        gap: var(--space-md);
        padding: var(--space-sm) var(--space-md);
        text-decoration: none;
        border-bottom: 1px solid var(--slate-100);
        transition: background 0.15s;
    }
    
    .review-location-row:last-child {
        border-bottom: none;
    }
    
    .review-location-row:hover {
        background: var(--white);
    }
    
    .review-location-name {
        flex: 1;
        font-size: var(--text-sm);
        color: var(--navy-800);
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .review-location-stats {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        font-size: var(--text-sm);
    }
    
    .review-location-rating {
        font-weight: 600;
        color: var(--amber-600);
    }
    
    .review-location-count {
        color: var(--slate-500);
    }
    
    .review-location-arrow {
        color: var(--slate-400);
        flex-shrink: 0;
    }
    
    .review-location-row:hover .review-location-arrow {
        color: var(--blue-600);
    }
    
    /* ==================== INFO GRID ==================== */
    .info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-md) var(--space-xl);
    }
    
    @media (max-width: 480px) {
        .info-grid { grid-template-columns: 1fr; }
    }
    
    .info-row {
        display: flex;
        justify-content: space-between;
        padding: var(--space-sm) 0;
        border-bottom: 1px solid var(--slate-100);
        font-size: var(--text-sm);
    }
    
    .info-label {
        color: var(--slate-500);
        display: flex;
        align-items: center;
        gap: var(--space-xs);
    }
    
    .info-value {
        font-weight: 500;
        text-align: right;
    }
    
    .info-value.green { color: var(--green-600); }
    .info-value.red { color: var(--red-600); }
    .info-value.amber { color: var(--amber-600); }
    
    /* ==================== COVERAGE ==================== */
    .coverage-areas-grid {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-sm);
    }
    
    .area-tag {
        display: inline-flex;
        align-items: center;
        padding: var(--space-xs) var(--space-sm);
        background: var(--slate-100);
        color: var(--slate-700);
        border-radius: var(--radius-sm);
        font-size: var(--text-sm);
        font-weight: 500;
    }
    
    .coverage-stats {
        display: flex;
        gap: var(--space-xl);
        margin-top: var(--space-lg);
        padding-top: var(--space-lg);
        border-top: 1px solid var(--slate-200);
    }
    
    .coverage-stat {
        text-align: center;
    }
    
    .coverage-stat-value {
        font-family: var(--font-display);
        font-size: var(--text-2xl);
        font-weight: 700;
        color: var(--navy-800);
    }
    
    .coverage-stat-label {
        font-size: var(--text-sm);
        color: var(--slate-500);
        margin-top: var(--space-xs);
    }
    
    /* ==================== SIMILAR FACTORS ==================== */
    .similar-factors-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: var(--space-md);
    }
    
    @media (max-width: 768px) {
        .similar-factors-grid { grid-template-columns: repeat(2, 1fr); }
    }
    
    @media (max-width: 480px) {
        .similar-factors-grid { grid-template-columns: 1fr; }
    }
    
    .similar-factor-card {
        padding: var(--space-md);
        background: var(--slate-50);
        border-radius: var(--radius-md);
        border: 1px solid var(--slate-100);
        transition: border-color 0.15s, box-shadow 0.15s;
    }
    
    .similar-factor-card:hover {
        border-color: var(--blue-600);
        box-shadow: var(--shadow-sm);
    }
    
    .similar-factor-name {
        font-weight: 600;
        font-size: var(--text-sm);
        margin-bottom: var(--space-xs);
        color: var(--navy-800);
    }
    
    .similar-factor-name a { color: inherit; }
    
    .similar-factor-badge {
        display: inline-block;
        padding: 2px 6px;
        border-radius: var(--radius-sm);
        font-size: 10px;
        font-weight: 600;
        margin-bottom: var(--space-sm);
    }
    
    .similar-factor-badge.clean { background: var(--emerald-100); color: var(--emerald-700); }
    .similar-factor-badge.green { background: var(--green-100); color: var(--green-700); }
    
    .similar-factor-stats {
        font-size: var(--text-xs);
        color: var(--slate-500);
    }
    
    /* ==================== FAQs ==================== */
    .faq-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-md);
    }
    
    .faq-item {
        border: 1px solid var(--slate-100);
        border-radius: var(--radius-md);
        overflow: hidden;
    }
    
    .faq-question {
        padding: var(--space-md);
        font-weight: 600;
        font-size: var(--text-sm);
        background: var(--slate-50);
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .faq-question:hover { background: var(--slate-100); }
    
    .faq-answer {
        padding: var(--space-md);
        font-size: var(--text-sm);
        color: var(--slate-500);
        line-height: 1.6;
        display: none;
    }
    
    .faq-item.open .faq-answer { display: block; }
    .faq-item.open .faq-question svg { transform: rotate(180deg); }
    
    /* ==================== SIDEBAR ==================== */
    .sidebar {
        position: sticky;
        top: 84px;
    }
    
    .sidebar-card {
        background: var(--white);
        border: 1px solid var(--slate-200);
        border-radius: var(--radius-lg);
        margin-bottom: var(--space-lg);
        overflow: hidden;
        box-shadow: var(--shadow-md);
    }
    
    .sidebar-section {
        padding: var(--space-lg);
        border-bottom: 1px solid var(--slate-100);
    }
    .sidebar-section:last-child { border-bottom: none; }
    
    .sidebar-title {
        font-family: var(--font-display);
        font-size: var(--text-base);
        font-weight: 600;
        color: var(--navy-900);
        margin-bottom: var(--space-md);
    }
    
    .contact-item {
        display: flex;
        align-items: flex-start;
        gap: var(--space-sm);
        padding: var(--space-sm) 0;
        font-size: var(--text-sm);
    }
    
    .contact-icon {
        flex-shrink: 0;
        width: 16px;
        height: 16px;
        color: var(--slate-500);
        margin-top: 2px;
    }
    
    .contact-value {
        color: var(--navy-800);
        word-break: break-word;
    }
    
    .source-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .source-item {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        padding: var(--space-xs) 0;
        font-size: var(--text-sm);
    }
    
    .source-check {
        width: 16px;
        height: 16px;
    }
    .source-check.available { color: var(--green-600); }
    .source-check.unavailable { color: var(--slate-400); }
    
    /* CTA Box */
    .cta-box {
        background: linear-gradient(135deg, var(--navy-900) 0%, var(--navy-950) 100%);
        color: white;
        padding: var(--space-lg);
        text-align: center;
    }
    
    .cta-title {
        font-family: var(--font-display);
        font-size: var(--text-lg);
        font-weight: 600;
        margin-bottom: var(--space-sm);
    }
    
    .cta-text {
        font-size: var(--text-sm);
        opacity: 0.9;
        margin-bottom: var(--space-md);
    }
    
    .cta-highlight {
        font-size: var(--text-xs);
        background: rgba(255,255,255,0.2);
        padding: var(--space-xs) var(--space-sm);
        border-radius: var(--radius-sm);
        margin-bottom: var(--space-md);
        display: inline-block;
    }
    
    .cta-button {
        display: inline-block;
        background: white;
        color: var(--navy-900);
        padding: var(--space-sm) var(--space-lg);
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: var(--text-sm);
        transition: transform 0.15s, box-shadow 0.15s;
    }
    .cta-button:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
        text-decoration: none;
    }
    
    .correction-link {
        display: block;
        padding: var(--space-md) var(--space-lg);
        text-align: center;
        font-size: var(--text-sm);
        color: var(--slate-500);
        background: var(--slate-50);
    }
    
    /* Mobile sticky CTA */
    .mobile-cta {
        display: none;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--navy-900);
        color: white;
        padding: var(--space-md);
        text-align: center;
        z-index: 100;
        box-shadow: 0 -4px 12px rgba(0,0,0,0.15);
    }
    
    @media (max-width: 968px) {
        .mobile-cta { display: block; }
        body.has-mobile-cta { padding-bottom: 70px; }
    }
    
    /* ==================== FOOTER ==================== */
    .site-footer {
        background: var(--navy-950);
        color: rgba(255,255,255,0.8);
        padding: 64px 24px 32px;
        margin-top: var(--space-2xl);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .footer-grid {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 2fr 1fr 1fr 1fr;
        gap: 48px;
    }
    
    @media (max-width: 768px) {
        .footer-grid {
            grid-template-columns: 1fr 1fr;
            gap: 32px;
        }
    }
    
    @media (max-width: 480px) {
        .footer-grid {
            grid-template-columns: 1fr;
        }
    }
    
    .footer-col h4 {
        font-size: var(--text-sm);
        font-weight: 600;
        color: white;
        margin-bottom: var(--space-md);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .footer-col a {
        display: block;
        color: rgba(255,255,255,0.7);
        font-size: var(--text-sm);
        padding: var(--space-xs) 0;
        transition: color 0.15s;
    }
    
    .footer-col a:hover {
        color: white;
        text-decoration: none;
    }
    
    .footer-about {
        font-size: var(--text-sm);
        line-height: 1.6;
        opacity: 0.8;
    }
    
    .footer-disclaimer {
        max-width: 1200px;
        margin: 32px auto 0;
        padding: 16px 24px;
        background: rgba(255,255,255,0.05);
        border-radius: var(--radius-md);
        font-size: var(--text-sm);
        color: rgba(255,255,255,0.7);
        text-align: center;
    }
    
    .footer-disclaimer a {
        color: rgba(255,255,255,0.9);
        text-decoration: underline;
    }
    
    .footer-bottom {
        max-width: 1200px;
        margin: 48px auto 0;
        padding-top: 24px;
        border-top: 1px solid rgba(255,255,255,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: var(--text-sm);
        color: rgba(255,255,255,0.5);
    }
    
    @media (max-width: 640px) {
        .footer-bottom {
            flex-direction: column;
            gap: var(--space-sm);
            text-align: center;
        }
    }
</style>

</head>
<body{% if profile.status == 'registered' and profile.factor_type not in ['RSL', 'Housing Association', 'Local Authority'] %} class="has-mobile-cta"{% endif %}>

<!-- ==================== SITE HEADER ==================== -->

<header class="site-header">
    <div class="header-inner">
        <a href="/" class="logo">
            <div class="logo-mark">CF</div>
            Compare Factors
        </a>
        <nav class="nav">
            <a href="/factors/" class="nav-link">All Factors</a>
            <a href="/areas/" class="nav-link">By Area</a>
            <a href="/methodology/" class="nav-link">How We Score</a>
            <a href="/guides/" class="nav-link">Guides</a>
            <a href="/get-quotes/" class="nav-link nav-cta">Get Quotes</a>
        </nav>
        <button class="burger" onclick="toggleMenu()" aria-label="Menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </div>
    <div class="mobile-nav" id="mobileNav">
        <a href="/factors/">All Factors</a>
        <a href="/areas/">By Area</a>
        <a href="/methodology/">How We Score</a>
        <a href="/guides/">Guides</a>
        <a href="/get-quotes/" class="nav-cta">Get Quotes</a>
    </div>
</header>

<!-- ==================== BREADCRUMB ==================== -->

<div class="container">
    <nav class="breadcrumb" aria-label="Breadcrumb">
        <a href="/">Home</a>
        <span>›</span>
        <a href="/factors/">Factors</a>
        <span>›</span>
        <span>{{ profile.name }}</span>
    </nav>
</div>

<!-- ==================== MAIN CONTENT ==================== -->

<div class="container">
    <div class="profile-layout">

    <main class="main-content">
        
        <!-- ==================== ALERT BANNERS ==================== -->
        {% if profile.status != 'registered' %}
        <div class="alert-banner alert-banner--expired" role="alert">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
            <div class="alert-banner-content">
                <div class="alert-banner-title">Registration Expired</div>
                This profile is included for historical completeness. {{ profile.name }} is no longer registered with the Scottish Property Factor Register and cannot legally provide factoring services.
            </div>
        </div>
        {% endif %}
        
        {% if profile.status == 'registered' and profile.factor_type in ['RSL', 'Housing Association', 'Local Authority'] %}
        <div class="alert-banner alert-banner--info" role="alert">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
            <div class="alert-banner-content">
                <div class="alert-banner-title">Switching Not Available</div>
                This factor is a {{ profile.factor_type }}. Homeowners in properties managed by this organisation typically cannot choose an alternative factor—the factoring arrangement is tied to the property ownership or tenancy structure.
            </div>
        </div>
        {% endif %}
        
        <!-- ==================== PROFILE HEADER ==================== -->
        <div class="profile-header">
            <div class="profile-header-top">
                <div class="profile-identity">
                    <h1>{{ profile.name }}</h1>
                    <div class="profile-meta">
                        <span class="profile-meta-item">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                            {{ profile.registration_number }}
                        </span>
                        {% if profile.factor_type %}
                        <span class="profile-meta-item">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                            </svg>
                            {{ profile.factor_type }}
                            <span class="tooltip-trigger" tabindex="0" role="button" aria-describedby="factor-type-tooltip">i<span class="tooltip-content" id="factor-type-tooltip">{% if profile.factor_type == 'Commercial' %}A private company providing factoring services for profit.{% elif profile.factor_type == 'RSL' or profile.factor_type == 'Housing Association' %}A Registered Social Landlord or housing association, typically non-profit.{% elif profile.factor_type == 'Sole Proprietor' %}An individual operating as a property factor.{% elif profile.factor_type == 'Local Authority' %}A council or local government body.{% else %}{{ profile.factor_type }}{% endif %}</span></span>
                        </span>
                        {% endif %}
                        <span class="profile-meta-item">
                            {% if profile.status == 'registered' %}
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--green-600)" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                            <span style="color: var(--green-600); font-weight: 500;">Active</span>
                            {% else %}
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--gray-500)" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="8" y1="12" x2="16" y2="12"></line></svg>
                            <span style="color: var(--gray-500); font-weight: 500;">Expired</span>
                            {% endif %}
                        </span>
                        {% if profile.property_count %}
                        <span class="profile-meta-item">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg>
                            {{ "{:,}".format(profile.property_count) }} properties
                        </span>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Risk Badge with Composite Score -->
                {% set band = profile.risk_band|default('CLEAN') %}
                {% set band_lower = band|lower %}
                {% set band_class = 'expired' if profile.status != 'registered' else {'CLEAN': 'clean', 'GREEN': 'green', 'AMBER': 'amber', 'ORANGE': 'orange', 'RED': 'red'}.get(band, 'clean') %}
                {% set score = profile.tribunal_composite_score|default(100) %}
                <div class="risk-badge {{ band_class }}" role="status" aria-label="{% if profile.status != 'registered' %}Historical tribunal rating{% else %}Tribunal risk rating: {{ band }}{% endif %}">
                    <div class="risk-badge-main">
                        {% if profile.status != 'registered' %}
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                        {{ band }}
                        {% elif band == 'CLEAN' %}
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                        {{ band }}
                        {% elif band == 'RED' %}
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                        {{ band }}
                        {% else %}
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                        {{ band }}
                        {% endif %}
                    </div>
                    <div class="risk-badge-reason">
                        {% if profile.status != 'registered' %}Historical record{% elif band == 'CLEAN' %}No upheld cases{% elif profile.tribunal_pfeo_penalty and profile.tribunal_pfeo_penalty > 0 %}Includes PFEO penalty{% else %}Tribunal record{% endif %}
                    </div>
                </div>
            </div>
            
            <!-- ==================== NEW: VERDICT BOX ==================== -->
            <div class="verdict-box {{ band_lower }}">
                <div class="verdict-header">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg>
                    Our Verdict
                </div>
                <p class="verdict-text">
                    {% if at_a_glance and at_a_glance.summary %}
                        <!-- Use AI generated summary if available -->
                        {{ at_a_glance.summary }}
                    {% else %}
                        <!-- Fallback Logic if AI missing -->
                        {{ profile.name }} is a <strong>
                        {% if profile.property_count and profile.property_count > 5000 %}large{% elif profile.property_count and profile.property_count > 1000 %}mid-sized{% else %}small{% endif %}
                        </strong> factor{% if profile.coverage_areas %} operating primarily in <strong>{{ profile.coverage_areas.split(',')[0].strip().replace('"', '').replace('&#34;', '') }}</strong> and surrounding areas{% endif %}.
                        
                        Based on our data, they hold a <strong>{{ band }}</strong> risk rating.
                        {% if band == 'CLEAN' %}
                        They have no significant tribunal history, suggesting a reliable service record.
                        {% elif band == 'AMBER' %}
                        Potential clients should be aware of a moderate frequency of tribunal disputes relative to their size.
                        {% elif band == 'RED' %}
                        They have a higher-than-average volume of tribunal cases or enforcement orders, which is a significant concern.
                        {% endif %}
                    {% endif %}
                </p>
            </div>
            
            <!-- ==================== AT A GLANCE ==================== -->
            <div class="at-a-glance">
                <h2 class="glance-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    At a Glance
                </h2>
                
                <!-- Key Stats Grid -->
                <div class="key-stats">
                    <div class="key-stat">
                        <div class="key-stat-value">{{ "{:,}".format(profile.property_count) if profile.property_count else '—' }}</div>
                        <div class="key-stat-label">
                            Properties
                            <span class="tooltip-trigger" tabindex="0" role="button" aria-describedby="properties-tooltip">i<span class="tooltip-content" id="properties-tooltip">Number of properties managed according to the Scottish Property Factor Register.</span></span>
                        </div>
                    </div>
                    
                    <div class="key-stat">
                        <div class="key-stat-value {{ band_class }}">{{ band }}</div>
                        <div class="key-stat-label">
                            Tribunal Rating
                            <span class="tooltip-trigger" tabindex="0" role="button" aria-describedby="tribunal-score-tooltip">i<span class="tooltip-content" id="tribunal-score-tooltip">Risk rating based on tribunal case history. CLEAN = no upheld cases, GREEN = minimal issues, AMBER = some concerns, ORANGE = significant issues, RED = serious concerns.</span></span>
                        </div>
                    </div>
                    
                    <div class="key-stat">
                        {% set total_cases = tribunal_last_5_years.case_count|default(0) %}
                        <div class="key-stat-value {% if total_cases > 10 %}amber{% elif total_cases > 0 %}muted{% endif %}">{{ total_cases }}</div>
                        <div class="key-stat-label">
                            Cases (5yr)
                            <span class="tooltip-trigger" tabindex="0" role="button" aria-describedby="cases-tooltip">i<span class="tooltip-content" id="cases-tooltip">Tribunal cases in the last 5 years. Includes all case types and outcomes.</span></span>
                        </div>
                    </div>
                    
                    <div class="key-stat">
                        {% set avg_rating = profile.combined_rating|default(0) %}
                        {% set rating_class = 'red' if avg_rating and avg_rating < 2.5 else ('amber' if avg_rating and avg_rating < 3.5 else 'green') %}
                        <div class="key-stat-value {% if avg_rating %}{{ rating_class }}{% endif %}">
                            {% if avg_rating %}{{ "%.1f"|format(avg_rating) }}★{% else %}—{% endif %}
                        </div>
                        <div class="key-stat-label">
                            Avg Rating
                            <span class="tooltip-trigger" tabindex="0" role="button" aria-describedby="rating-tooltip">i<span class="tooltip-content" id="rating-tooltip">Weighted average from Google Reviews and Trustpilot based on review count.</span></span>
                        </div>
                        {% set total_reviews = (profile.google_review_count|default(0)) + (profile.trustpilot_review_count|default(0)) %}
                        {% if total_reviews > 0 %}
                        <div class="key-stat-benchmark">{{ total_reviews }} reviews</div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Detailed Insights -->
                <div class="glance-grid">
                    
                    {% if at_a_glance and at_a_glance.bullets %}
                        <!-- AI Generated Insights -->
                        {% for bullet in at_a_glance.bullets[:4] %}
                        <div class="glance-item">
                            <svg class="glance-icon amber" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                            <span>{{ bullet }}</span>
                        </div>
                        {% endfor %}
                    {% else %}
                        <!-- Fallback Insights -->
                        <!-- Tribunal insight -->
                        <div class="glance-item">
                            {% if tribunal_full_history.case_count == 0 %}
                            <svg class="glance-icon green" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                            <span><strong>No tribunal cases</strong> on record</span>
                            {% elif tribunal_last_5_years.case_count > 0 %}
                            <svg class="glance-icon amber" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                            <span><strong>{{ tribunal_last_5_years.case_count }} tribunal case{{ 's' if tribunal_last_5_years.case_count != 1 else '' }}</strong> in last 5 years</span>
                            {% else %}
                            <svg class="glance-icon green" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                            <span><strong>No recent tribunal cases</strong> (5 years)</span>
                            {% endif %}
                        </div>
                        
                        <!-- PFEO insight -->
                        <div class="glance-item">
                            {% if profile.has_active_pfeo %}
                            <svg class="glance-icon red" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                            <span><strong>Active enforcement order</strong> — factor failed to comply with tribunal ruling</span>
                            {% elif profile.tribunal_pfeo_count and profile.tribunal_pfeo_count > 0 %}
                            <svg class="glance-icon amber" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                            <span><strong>{{ profile.tribunal_pfeo_count }} enforcement order{{ 's' if profile.tribunal_pfeo_count != 1 else '' }}</strong> on record</span>
                            {% else %}
                            <svg class="glance-icon green" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                            <span><strong>No enforcement orders</strong> on record</span>
                            {% endif %}
                        </div>
                        
                        <!-- TPI membership -->
                        <div class="glance-item">
                            {% if profile.tpi_member %}
                            <svg class="glance-icon green" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                            <span><strong>TPI Scotland member</strong> — voluntary code of conduct</span>
                            {% else %}
                            <svg class="glance-icon muted" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                            <span>No professional body membership on record</span>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- ==================== REVIEWS ==================== -->
        <section class="card" id="reviews">
            <div class="card-header">
                <h2 class="card-title">
                    Ratings & Reviews
                    <span class="tooltip-trigger" tabindex="0" role="button" aria-describedby="reviews-tooltip">i<span class="tooltip-content" id="reviews-tooltip">Public reviews collected from Google Maps and Trustpilot. We weight the average by review count.</span></span>
                </h2>
            </div>
            <div class="card-body">
                <div class="review-platforms">
                    <!-- Google -->
                    <div class="review-platform">
                        <div class="platform-logo google">G</div>
                        <div>
                            {% if profile.google_rating %}
                            <div class="platform-rating">{{ "%.1f"|format(profile.google_rating) }}</div>
                            <div class="platform-stars">{% for i in range(5) %}{% if i < (profile.google_rating|round|int) %}★{% else %}☆{% endif %}{% endfor %}</div>
                            <div class="platform-count">{{ profile.google_review_count }} reviews</div>
                            {% else %}
                            <div class="platform-empty">No Google listing found</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Trustpilot -->
                    <div class="review-platform">
                        <div class="platform-logo trustpilot">★</div>
                        <div>
                            {% if profile.trustpilot_rating %}
                            <div class="platform-rating">{{ "%.1f"|format(profile.trustpilot_rating) }}</div>
                            <div class="platform-stars">{% for i in range(5) %}{% if i < (profile.trustpilot_rating|round|int) %}★{% else %}☆{% endif %}{% endfor %}</div>
                            <div class="platform-count">{{ profile.trustpilot_review_count }} reviews</div>
                            {% else %}
                            <div class="platform-empty">No Trustpilot listing found</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                {% set total_reviews = (profile.google_review_count|default(0)) + (profile.trustpilot_review_count|default(0)) %}
                {% if profile.combined_rating and total_reviews > 0 %}
                <div class="rating-explanation">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    <span><strong>{{ "%.1f"|format(profile.combined_rating) }}★ weighted average</strong> calculated from {{ profile.google_review_count|default(0) }} Google + {{ profile.trustpilot_review_count|default(0) }} Trustpilot reviews</span>
                </div>
                {% endif %}
                
                {% if recent_reviews and recent_reviews|length > 0 %}
                {# Separate reviews with text from aggregate-only records #}
                {% set reviews_with_text = recent_reviews|selectattr('review_text')|list %}
                {% set aggregate_reviews = recent_reviews|rejectattr('review_text')|list %}
                
                {# Show actual review text if we have it #}
                {% if reviews_with_text|length > 0 %}
                <div class="review-snippets">
                    <h4 class="review-snippets-title">Recent Reviews</h4>
                    {% for review in reviews_with_text[:5] %}
                    <div class="review-snippet">
                        <div class="review-snippet-header">
                            <span class="platform-badge platform-badge--{{ review.platform }}">{{ review.platform|title }}</span>
                            <span class="review-rating">{% if review.rating %}{{ "%.1f"|format(review.rating) }}★{% endif %}</span>
                        </div>
                        <div class="review-snippet-text">"{{ review.review_text|truncate(300) }}"</div>
                        <div class="review-snippet-meta">
                            <span class="review-author">— {{ review.author_name or 'Anonymous' }}</span>
                            {% if review.review_date %}
                            <span class="review-date">{{ review.review_date }}</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                
                {# Show review sources with direct links #}
                <div class="review-sources">
                    <h4 class="review-sources-title">Read Reviews</h4>
                    
                    {% if google_locations and google_locations|length > 1 %}
                    {# Multiple Google locations - show each separately #}
                    <div class="review-locations-breakdown">
                        <div class="review-locations-header">
                            <span class="platform-icon platform-icon--google">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                            </span>
                            <span class="review-locations-summary">Google Reviews · {{ profile.google_review_count }} total across {{ google_locations|length }} locations</span>
                        </div>
                        <div class="review-locations-list">
                            {% for loc in google_locations %}
                            <a href="{% if loc.place_id %}https://search.google.com/local/reviews?placeid={{ loc.place_id }}{% elif loc.url %}{{ loc.url }}{% else %}https://www.google.com/search?q={{ loc.name|urlencode }}+{{ profile.name|urlencode }}+reviews{% endif %}" target="_blank" rel="noopener" class="review-location-row">
                                <div class="review-location-name">{{ loc.name|default(loc.address|default('Office')) }}</div>
                                <div class="review-location-stats">
                                    <span class="review-location-rating">{{ "%.1f"|format(loc.rating) if loc.rating else '—' }}★</span>
                                    <span class="review-location-count">{{ loc.review_count|default(0) }} reviews</span>
                                </div>
                                <svg class="review-location-arrow" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                    {% elif profile.google_review_count and profile.google_review_count > 0 %}
                    {# Single Google location or aggregate only #}
                    <div class="review-sources-list">
                        <a href="{% if google_places and google_places.place_id %}https://search.google.com/local/reviews?placeid={{ google_places.place_id }}{% else %}https://www.google.com/search?q={{ profile.name|urlencode }}+property+factor+reviews{% endif %}" target="_blank" rel="noopener" class="review-source-link review-source-link--google">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                            <span class="review-source-text">
                                <span class="review-source-platform">Google Reviews</span>
                                <span class="review-source-count">{{ profile.google_review_count }} reviews · {{ "%.1f"|format(profile.google_rating) }}★</span>
                            </span>
                            <svg class="review-source-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                        </a>
                    </div>
                    {% endif %}
                    
                    {% if profile.trustpilot_review_count and profile.trustpilot_review_count > 0 %}
                    <div class="review-sources-list" style="margin-top: var(--space-sm);">
                        <a href="{% if trustpilot and trustpilot.url %}{{ trustpilot.url }}{% else %}https://uk.trustpilot.com/search?query={{ profile.name|urlencode }}{% endif %}" target="_blank" rel="noopener" class="review-source-link review-source-link--trustpilot">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                            <span class="review-source-text">
                                <span class="review-source-platform">Trustpilot</span>
                                <span class="review-source-count">{{ profile.trustpilot_review_count }} reviews · {{ "%.1f"|format(profile.trustpilot_rating) }}★</span>
                            </span>
                            <svg class="review-source-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                        </a>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            {% if profile.google_review_count or profile.trustpilot_review_count %}
            <div class="card-footer">
                <span>Reviews are collected from public listings and may not represent all customer experiences.</span>
                {% if reviews_updated %}
                <span class="card-footer-timestamp">Updated: {{ reviews_updated }}</span>
                {% endif %}
            </div>
            {% endif %}
        </section>
        
        <!-- ==================== TRIBUNAL RECORD ==================== -->
        <section class="card" id="tribunal">
            <div class="card-header">
                <h2 class="card-title">
                    Tribunal Record
                    <span class="tooltip-trigger" tabindex="0" role="button" aria-describedby="tribunal-tooltip">i<span class="tooltip-content" id="tribunal-tooltip">Cases heard by the Housing & Property Chamber. Homeowners can raise complaints about code breaches, fees, or service failures.</span></span>
                </h2>
                {% if tribunal_full_history.case_count > 0 %}
                <div class="card-header-links">
                    <a href="/factors/{{ profile.registration_number|lower }}/tribunal/" class="card-link">Full history →</a>
                    <a href="https://housingandpropertychamber.scot/apply-tribunal/property-factors/property-factors-decisions" target="_blank" rel="noopener" class="card-link">HPC decisions ↗</a>
                </div>
                {% endif %}
            </div>
            <div class="card-body">
                
                {% if tribunal_full_history.case_count == 0 %}
                <div class="empty-state">
                    <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                    <p>No tribunal cases on record for this factor.</p>
                </div>
                {% else %}
                
                <div class="tribunal-grid">
                    <!-- Last 5 Years -->
                    <div class="tribunal-period">
                        <div class="tribunal-period-title">Last 5 Years</div>
                        <div class="tribunal-stat-row">
                            <span class="tribunal-stat-label">
                                Cases
                                <span class="tooltip-trigger" tabindex="0" role="button">i<span class="tooltip-content">Total applications to the tribunal, regardless of outcome.</span></span>
                            </span>
                            <span class="tribunal-stat-value">{{ tribunal_last_5_years.case_count|default(0) }}</span>
                        </div>
                        <div class="tribunal-stat-row">
                            <span class="tribunal-stat-label">
                                Upheld
                                <span class="tooltip-trigger" tabindex="0" role="button">i<span class="tooltip-content">Complaints where the tribunal found in favour of the homeowner (fully or partially).</span></span>
                            </span>
                            <span class="tribunal-stat-value {% if tribunal_last_5_years.complaints_upheld_pct and tribunal_last_5_years.complaints_upheld_pct > 50 %}red{% endif %}">
                                {% if tribunal_last_5_years.complaints_upheld_pct %}{{ tribunal_last_5_years.complaints_upheld_pct|int }}%{% else %}—{% endif %}
                                <span class="benchmark-indicator">(avg 47%)</span>
                            </span>
                        </div>
                        <div class="tribunal-stat-row">
                            <span class="tribunal-stat-label">
                                Rate/10k
                                <span class="tooltip-trigger" tabindex="0" role="button">i<span class="tooltip-content">Cases per 10,000 properties managed. Allows fair comparison between large and small factors.</span></span>
                            </span>
                            <span class="tribunal-stat-value">{{ "%.1f"|format(tribunal_last_5_years.rate_per_10k) if tribunal_last_5_years.rate_per_10k else '—' }}</span>
                        </div>
                        <div class="tribunal-stat-row">
                            <span class="tribunal-stat-label">
                                PFEOs
                                <span class="tooltip-trigger" tabindex="0" role="button">i<span class="tooltip-content">Property Factor Enforcement Orders. Issued when a factor fails to comply with a tribunal decision. Very serious.</span></span>
                            </span>
                            <span class="tribunal-stat-value {% if tribunal_last_5_years.pfeo_count and tribunal_last_5_years.pfeo_count > 0 %}red{% endif %}">{{ tribunal_last_5_years.pfeo_count|default(0) }}</span>
                        </div>
                    </div>
                    
                    <!-- Full History -->
                    <div class="tribunal-period">
                        <div class="tribunal-period-title">Full History{% if tribunal_full_history.first_case_year %} (since {{ tribunal_full_history.first_case_year }}){% endif %}</div>
                        <div class="tribunal-stat-row">
                            <span class="tribunal-stat-label">Total cases</span>
                            <span class="tribunal-stat-value">{{ tribunal_full_history.case_count|default(0) }}</span>
                        </div>
                        <div class="tribunal-stat-row">
                            <span class="tribunal-stat-label">Total PFEOs</span>
                            <span class="tribunal-stat-value {% if tribunal_full_history.pfeo_count and tribunal_full_history.pfeo_count > 0 %}red{% endif %}">{{ tribunal_full_history.pfeo_count|default(0) }}</span>
                        </div>
                        <div class="tribunal-stat-row">
                            <span class="tribunal-stat-label">
                                Compensation
                                <span class="tooltip-trigger" tabindex="0" role="button">i<span class="tooltip-content">Total compensation ordered by the tribunal to be paid to homeowners.</span></span>
                            </span>
                            <span class="tribunal-stat-value">{% if tribunal_full_history.compensation %}£{{ "{:,.0f}".format(tribunal_full_history.compensation) }}{% else %}£0{% endif %}</span>
                        </div>
                        <div class="tribunal-stat-row">
                            <span class="tribunal-stat-label">Rate/10k</span>
                            <span class="tribunal-stat-value">{{ "%.1f"|format(tribunal_full_history.rate_per_10k) if tribunal_full_history.rate_per_10k else '—' }}</span>
                        </div>
                    </div>
                </div>
                
                <!-- Complaint Categories -->
                {% if complaint_categories and complaint_categories|length > 0 %}
                <div class="complaint-categories">
                    <div class="complaint-categories-title">Top complaint themes (last 5 years)</div>
                    <div class="complaint-bar-list">
                        {% set total_complaints = complaint_categories.values()|sum %}
                        {% for category, count in complaint_categories.items()|sort(attribute='1', reverse=true) %}
                        {% if loop.index <= 4 %}
                        {% set pct = (count / total_complaints * 100)|int %}
                        <div class="complaint-bar-item">
                            <span class="complaint-bar-label">{{ category }}</span>
                            <div class="complaint-bar-track">
                                <div class="complaint-bar-fill" style="width: {{ pct }}%;"></div>
                            </div>
                            <span class="complaint-bar-pct">{{ pct }}%</span>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Trend Chart -->
                {% if cases_by_year and cases_by_year|length > 1 %}
                <div class="tribunal-trend">
                    <div class="trend-title">
                        Cases by Year
                        <span class="tooltip-trigger" tabindex="0" role="button">i<span class="tooltip-content">Annual tribunal case volume. Shows how complaint frequency has changed over time.</span></span>
                    </div>
                    {% set max_cases = cases_by_year|map(attribute='cases')|max %}
                    {% set max_year = cases_by_year|selectattr('cases', 'equalto', max_cases)|first %}
                    {% if max_cases > 5 %}
                    <div class="trend-context">{{ max_cases }} cases in {{ max_year.year }} (highest in {{ cases_by_year|length }} years)</div>
                    {% endif %}
                    <div class="trend-chart-wrapper">
                        <div class="trend-y-axis">
                            <span>{{ max_cases }}</span>
                            <span>{{ (max_cases / 2)|int }}</span>
                            <span>0</span>
                        </div>
                        <div class="trend-chart" role="img" aria-label="Bar chart showing tribunal cases by year">
                            {% for year_data in cases_by_year %}
                            <div class="trend-bar-wrapper {% if year_data.cases == max_cases %}highlight{% endif %}">
                                <div class="trend-bar-value">{{ year_data.cases }}</div>
                                <div class="trend-bar" style="height: {{ (year_data.cases / max_cases * 70)|int if max_cases else 4 }}px;" title="{{ year_data.cases }} cases in {{ year_data.year }}"></div>
                                {% if year_data.pfeos and year_data.pfeos > 0 %}
                                <div class="trend-bar pfeo" style="height: {{ (year_data.pfeos / max_cases * 70)|int }}px;" title="{{ year_data.pfeos }} PFEOs"></div>
                                {% endif %}
                                <div class="trend-label">'{{ year_data.year|string|slice(-2) }}</div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
                
                {% endif %}
            </div>
            <div class="card-footer">
                <span>Case summaries and statistics are AI-generated from official HPC decisions. <a href="https://housingandpropertychamber.scot/apply-tribunal/property-factors/property-factors-decisions" target="_blank" rel="noopener">Verify with official records ↗</a></span>
                {% if tribunal_updated %}
                <span class="card-footer-timestamp">Updated: {{ tribunal_updated }}</span>
                {% endif %}
            </div>
        </section>
        
        <!-- ==================== RECENT TRIBUNAL DECISIONS ==================== -->
        {% if recent_cases and recent_cases|length > 0 %}
        <section class="card" id="recent-cases">
            <div class="card-header">
                <h2 class="card-title">Recent Decisions</h2>
                <div class="card-header-links">
                    <a href="/factors/{{ profile.registration_number|lower }}/tribunal/" class="card-link">Full history →</a>
                    <a href="https://housingandpropertychamber.scot/apply-tribunal/property-factors/property-factors-decisions" target="_blank" rel="noopener" class="card-link">HPC decisions ↗</a>
                </div>
            </div>
            <div class="card-body">
                <div class="cases-list" id="cases-list">
                    {% for case in recent_cases %}
                    <div class="case-card {% if loop.index > 3 %}hidden{% endif %}">
                        <div class="case-header">
                            <div>
                                <div class="case-ref">{{ case.case_reference }}</div>
                                <div class="case-date">{{ case.decision_date }}</div>
                            </div>
                            <div class="case-badges">
                                {% if case.outcome %}
                                {% set outcome_lower = case.outcome|lower %}
                                {% set outcome_class = 'upheld' if 'upheld' in outcome_lower and 'not' not in outcome_lower and 'partial' not in outcome_lower else 'partial' if 'partial' in outcome_lower else 'dismissed' if 'dismiss' in outcome_lower or 'not upheld' in outcome_lower else 'withdrawn' if 'withdrawn' in outcome_lower else 'other' %}
                                <span class="outcome-badge outcome-badge--{{ outcome_class }}">{{ case.outcome }}</span>
                                {% endif %}
                                {% if case.severity_score %}
                                {% set sev = case.severity_score|float %}
                                {% set sev_class = 'critical' if sev >= 8 else 'high' if sev >= 6 else 'medium' if sev >= 4 else 'low' %}
                                <span class="severity-badge severity-badge--{{ sev_class }}" title="Case severity: {{ case.severity_score }}/10">{{ case.severity_score }}/10</span>
                                {% endif %}
                            </div>
                        </div>
                        {% if case.summary %}
                        <div class="case-summary">{{ case.summary|truncate(200) }}</div>
                        {% endif %}
                        {% set quote_text = case.key_quote or case.quote %}
                        {% if quote_text %}
                        <div class="case-quote">"{{ quote_text|truncate(150) }}"</div>
                        {% endif %}
                        <div class="case-footer">
                            <div class="case-meta">
                                {% set comp = case.compensation_awarded or case.compensation or 0 %}
                                {% if comp and comp > 0 %}
                                <span>£{{ "{:,.0f}".format(comp) }} compensation</span>
                                {% endif %}
                                {% if case.pfeo_issued %}
                                <span class="pfeo-indicator">⚠ PFEO issued</span>
                                {% endif %}
                            </div>
                            <div class="case-links">
                                {% if case.pdf_url %}
                                <a href="{{ case.pdf_url }}" target="_blank" rel="noopener" class="case-link">View decision (PDF) →</a>
                                {% else %}
                                <a href="https://housingandpropertychamber.scot/apply-tribunal/property-factors/property-factors-decisions" target="_blank" rel="noopener" class="case-link">View on HPC →</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% if recent_cases|length > 3 %}
                <button class="cases-toggle" id="cases-toggle" onclick="toggleCases()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
                    <span id="toggle-text">Show {{ recent_cases|length - 3 }} more recent cases</span>
                </button>
                {% endif %}
            </div>
            <div class="card-footer">
                <span>Summaries are AI-generated. View official PDFs linked on each case for authoritative records.</span>
            </div>
        </section>
        {% endif %}
        
        <!-- ==================== FEES & CHARGES ==================== -->
        {% if wss or (case_fees and case_fees|length > 0) %}
        <section class="card" id="fees">
            <div class="card-header">
                <h2 class="card-title">
                    Fees & Charges
                    <span class="tooltip-trigger" tabindex="0" role="button">i<span class="tooltip-content">Fee information from official documents and tribunal decisions. Actual fees vary by property.</span></span>
                </h2>
            </div>
            <div class="card-body">
                
                <!-- Important Caveat -->
                <div class="fees-caveat">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    <p>Fees vary significantly between properties based on size, services required, and location. Contact {{ profile.name }} directly for an accurate quote for your property.</p>
                </div>
                
                {% if wss and (wss.management_fee_amount or wss.insurance_admin_fee or wss.late_penalty) %}
                <!-- WSS Fees Section -->
                <div class="fees-source-section">
                    <div class="fees-source-header">
                        <h4>From Written Statement of Services</h4>
                        {% if wss.document_url %}
                        <a href="{{ wss.document_url }}" target="_blank" rel="noopener" class="fees-source-link">View WSS →</a>
                        {% endif %}
                    </div>
                    <div class="fee-grid">
                        {% if wss.management_fee_amount %}
                        {% set fee_val = wss.management_fee_amount|string %}
                        {% set is_price = fee_val.startswith('£') or fee_val.startswith('0') or fee_val.startswith('1') or fee_val.startswith('2') or fee_val.startswith('3') or fee_val.startswith('4') or fee_val.startswith('5') or fee_val.startswith('6') or fee_val.startswith('7') or fee_val.startswith('8') or fee_val.startswith('9') %}
                        <div class="fee-item">
                            <div class="fee-value">{% if is_price %}{% if not fee_val.startswith('£') %}£{% endif %}{{ wss.management_fee_amount }}{% else %}Varies{% endif %}</div>
                            <div class="fee-label">Management Fee{% if wss.management_fee_frequency %} ({{ wss.management_fee_frequency }}){% endif %}</div>
                            {% if is_price %}
                            <div class="fee-benchmark">Market: £120-350/yr</div>
                            {% else %}
                            <div class="fee-note">{{ wss.management_fee_amount }}</div>
                            {% endif %}
                        </div>
                        {% endif %}
                        {% if wss.insurance_admin_fee %}
                        <div class="fee-item">
                            <div class="fee-value">{{ wss.insurance_admin_fee }}</div>
                            <div class="fee-label">Insurance Admin</div>
                        </div>
                        {% endif %}
                        {% if wss.late_penalty %}
                        <div class="fee-item">
                            <div class="fee-value">{{ wss.late_penalty }}</div>
                            <div class="fee-label">Late Payment</div>
                        </div>
                        {% endif %}
                    </div>
                    <div class="fees-source-attribution">
                        <span>Source: Scottish Government WSS Register</span>
                    </div>
                </div>
                {% endif %}
                
                {% if case_fees and case_fees|length > 0 %}
                <!-- Tribunal Fees Section -->
                <div class="fees-source-section {% if wss and (wss.management_fee_amount or wss.insurance_admin_fee) %}fees-source-section--separated{% endif %}">
                    <div class="fees-source-header">
                        <h4>Fees Referenced in Tribunal Decisions</h4>
                    </div>
                    <p class="fees-context">The following fees were mentioned in tribunal cases. These are examples from specific properties and may not reflect current pricing.</p>
                    <div class="tribunal-fees-list">
                        {% for fee in case_fees %}
                        <div class="tribunal-fee-group {% if fee.example_count > 1 %}expandable{% endif %}">
                            <div class="tribunal-fee-header" {% if fee.example_count > 1 %}onclick="this.parentElement.classList.toggle('expanded')"{% endif %}>
                                <div class="tribunal-fee-info">
                                    <span class="tribunal-fee-type">{{ fee.fee_type }}</span>
                                    {% if fee.example_count > 1 %}
                                    <span class="tribunal-fee-count">{{ fee.example_count }} examples</span>
                                    {% endif %}
                                </div>
                                <div class="tribunal-fee-details">
                                    {% if fee.amount_min and fee.amount_max and fee.amount_min != fee.amount_max %}
                                    <span class="tribunal-fee-amount">£{{ "%.0f"|format(fee.amount_min) }}–£{{ "%.0f"|format(fee.amount_max) }}</span>
                                    {% else %}
                                    <span class="tribunal-fee-amount">£{{ "%.2f"|format(fee.amount_min) }}</span>
                                    {% endif %}
                                    {% if fee.frequency %}
                                    <span class="tribunal-fee-frequency">{{ fee.frequency }}</span>
                                    {% endif %}
                                    {% if fee.example_count > 1 %}
                                    <svg class="tribunal-fee-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
                                    {% endif %}
                                </div>
                            </div>
                            {% if fee.details and fee.example_count > 1 %}
                            <div class="tribunal-fee-details-list">
                                {% for item in fee.details %}
                                <div class="tribunal-fee-item-row">
                                    <a href="{% if item.pdf_url %}{{ item.pdf_url }}{% else %}https://housingandpropertychamber.scot/apply-tribunal/property-factors/property-factors-decisions{% endif %}" target="_blank" rel="noopener" class="tribunal-fee-case">{{ item.case_reference or 'View case' }}</a>
                                    <div class="tribunal-fee-item-details">
                                        <span class="tribunal-fee-item-amount">£{{ "%.2f"|format(item.amount) }}</span>
                                        {% if item.frequency %}
                                        <span class="tribunal-fee-item-freq">{{ item.frequency }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            {% elif fee.details and fee.example_count == 1 %}
                            {# Single item - show case link inline #}
                            <div class="tribunal-fee-single-case">
                                <a href="{% if fee.details[0].pdf_url %}{{ fee.details[0].pdf_url }}{% else %}https://housingandpropertychamber.scot/apply-tribunal/property-factors/property-factors-decisions{% endif %}" target="_blank" rel="noopener" class="tribunal-fee-case">{{ fee.details[0].case_reference }}</a>
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    <div class="fees-source-attribution">
                        <span>Source: Housing & Property Chamber decisions</span>
                    </div>
                </div>
                {% endif %}
                
            </div>
            <div class="card-footer">
                <span>Always request a formal quote before committing to a new factor.</span>
            </div>
        </section>
        {% endif %}
        
        <!-- ==================== WRITTEN STATEMENT OF SERVICES ==================== -->
        <section class="card" id="wss">
            <div class="card-header">
                <h2 class="card-title">
                    Written Statement of Services
                    <span class="tooltip-trigger" tabindex="0" role="button">i<span class="tooltip-content">Property factors are legally required to provide a WSS detailing fees, response times, and service standards.</span></span>
                </h2>
                {% if wss and wss.document_url %}
                <a href="{{ wss.document_url }}" class="card-link" target="_blank" rel="noopener">View Document →</a>
                {% endif %}
            </div>
            <div class="card-body">
                {% if wss %}
                <div class="info-grid">
                    <div>
                        <h4 style="margin: 0 0 var(--space-sm) 0; font-size: var(--text-sm); text-transform: uppercase; letter-spacing: 0.05em; color: var(--slate-500);">Response Times</h4>
                        <div class="info-row"><span class="info-label">Emergency</span><span class="info-value">{{ wss.emergency_response or '—' }}</span></div>
                        <div class="info-row"><span class="info-label">Urgent</span><span class="info-value">{{ wss.urgent_response or '—' }}</span></div>
                        <div class="info-row"><span class="info-label">Routine</span><span class="info-value">{{ wss.routine_response or '—' }}</span></div>
                        <div class="info-row"><span class="info-label">Complaints</span><span class="info-value">{{ wss.complaint_response or '—' }}</span></div>
                    </div>
                    <div>
                        <h4 style="margin: 0 0 var(--space-sm) 0; font-size: var(--text-sm); text-transform: uppercase; letter-spacing: 0.05em; color: var(--slate-500);">Service Features</h4>
                        <div class="info-row"><span class="info-label">NOPLI Policy<span class="tooltip-trigger" tabindex="0" role="button">i<span class="tooltip-content">If "Yes", the factor may charge you for unpaid debts of other owners.</span></span></span><span class="info-value {% if wss.nopli %}amber{% else %}green{% endif %}">{% if wss.nopli %}Yes{% elif wss.nopli == 0 %}No{% else %}—{% endif %}</span></div>
                        <div class="info-row"><span class="info-label">Sinking Fund</span><span class="info-value">{% if wss.sinking_fund %}Available{% elif wss.sinking_fund == 0 %}Not offered{% else %}—{% endif %}</span></div>
                        <div class="info-row"><span class="info-label">Online Portal</span><span class="info-value">{{ wss.portal or '—' }}</span></div>
                        <div class="info-row"><span class="info-label">Notice Period</span><span class="info-value">{{ wss.notice_period or '—' }}</span></div>
                    </div>
                </div>
                {% else %}
                <div style="text-align: center; padding: var(--space-xl); color: var(--slate-500);">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin: 0 auto var(--space-md);"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                    <p style="margin: 0 0 var(--space-sm);"><strong>Written Statement not available</strong></p>
                    <p style="margin: 0; font-size: var(--text-sm);">We have not been able to source a WSS for {{ profile.name }}. Reach out to them directly to request a copy.</p>
                </div>
                {% endif %}
            </div>
        </section>
        
        <!-- ==================== FAQs ==================== -->
        <section class="card" id="faqs">
            <div class="card-header">
                <h2 class="card-title">Frequently Asked Questions</h2>
            </div>
            <div class="card-body">
                <div class="faq-list">
                    <div class="faq-item open">
                        <div class="faq-question" onclick="this.parentElement.classList.toggle('open')">
                            Has {{ profile.name }} had any tribunal cases?
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
                        </div>
                        <div class="faq-answer">
                            {% if tribunal_full_history.case_count > 0 %}Yes, {{ profile.name }} has had {{ tribunal_full_history.case_count }} tribunal cases{% if tribunal_full_history.first_case_year %} since {{ tribunal_full_history.first_case_year }}{% endif %}. {% if tribunal_last_5_years.case_count > 0 %}In the last 5 years: {{ tribunal_last_5_years.case_count }} cases with {{ tribunal_last_5_years.complaints_upheld_pct|default(0)|int }}% upheld (industry avg 47%).{% endif %}{% else %}No, {{ profile.name }} has no tribunal cases on record.{% endif %}
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question" onclick="this.parentElement.classList.toggle('open')">
                            How do I make a complaint about {{ profile.name }}?
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
                        </div>
                        <div class="faq-answer">First, raise your complaint directly with {{ profile.name }} using their formal complaints procedure. If unresolved after 8 weeks, apply to the Housing & Property Chamber at <a href="https://housingandpropertychamber.scot">housingandpropertychamber.scot</a>.</div>
                    </div>
                    {% if profile.status == 'registered' and profile.factor_type not in ['RSL', 'Housing Association', 'Local Authority'] %}
                    <div class="faq-item">
                        <div class="faq-question" onclick="this.parentElement.classList.toggle('open')">
                            How do I switch away from {{ profile.name }}?
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
                        </div>
                        <div class="faq-answer">You'll need a majority vote from property owners (typically at an AGM or EGM). The new factor must be registered. Our <a href="/guides/how-to-switch-factors-scotland/">switching guide</a> explains the full process.</div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </section>
        
        <!-- ==================== COVERAGE AREA ==================== -->
        <section class="card" id="coverage">
            <div class="card-header">
                <h2 class="card-title">Coverage Area</h2>
            </div>
            <div class="card-body">
                {% if profile.coverage_areas %}
                <p style="color: var(--slate-600); margin-bottom: var(--space-md);">{{ profile.name }} provides factoring services in the following areas:</p>
                
                <div class="coverage-areas-grid">
                    {% for area in profile.coverage_areas.split(',') %}
                    {% set clean_area = area.strip().replace('"', '').replace('&#34;', '') %}
                    {% if clean_area %}
                    <span class="area-tag">{{ clean_area }}</span>
                    {% endif %}
                    {% endfor %}
                </div>
                
                <p style="font-size: 0.75rem; color: var(--slate-400); margin-top: var(--space-md); font-style: italic;">
                    Based on properties registered with the Scottish Property Factor Register.
                </p>
                
                <div class="coverage-stats">
                    {% if profile.postcode_count %}
                    <div class="coverage-stat">
                        <div class="coverage-stat-value">{{ profile.postcode_count }}</div>
                        <div class="coverage-stat-label">Postcode areas</div>
                    </div>
                    {% endif %}
                    {% if profile.property_count %}
                    <div class="coverage-stat">
                        <div class="coverage-stat-value">{{ "{:,}".format(profile.property_count) }}</div>
                        <div class="coverage-stat-label">Properties managed</div>
                    </div>
                    {% endif %}
                </div>
                {% elif profile.property_count or profile.postcode_count %}
                {# We have stats but no detailed area breakdown #}
                <p style="color: var(--slate-600); margin-bottom: var(--space-md);">Coverage area details are not available, but we know {{ profile.name }} manages properties in Scotland.</p>
                
                <div class="coverage-stats">
                    {% if profile.postcode_count %}
                    <div class="coverage-stat">
                        <div class="coverage-stat-value">{{ profile.postcode_count }}</div>
                        <div class="coverage-stat-label">Postcode areas</div>
                    </div>
                    {% endif %}
                    {% if profile.property_count %}
                    <div class="coverage-stat">
                        <div class="coverage-stat-value">{{ "{:,}".format(profile.property_count) }}</div>
                        <div class="coverage-stat-label">Properties managed</div>
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <p style="color: var(--slate-500);">No coverage data available for this factor.</p>
                {% endif %}
            </div>
        </section>
        
        <!-- ==================== SIMILAR FACTORS ==================== -->
        {% if similar_factors and similar_factors|length > 0 and profile.status == 'registered' and profile.factor_type not in ['RSL', 'Housing Association', 'Local Authority'] %}
        <section class="card" id="alternatives">
            <div class="card-header">
                <h2 class="card-title">
                    Better-Rated Alternatives in Your Area
                    <span class="tooltip-trigger" tabindex="0" role="button">i<span class="tooltip-content">Other property factors serving similar areas with better tribunal ratings.</span></span>
                </h2>
                <a href="/factors/?sort=rating" class="card-link">View all →</a>
            </div>
            <div class="card-body">
                <div class="similar-factors-grid">
                    {% for factor in similar_factors[:3] %}
                    <div class="similar-factor-card">
                        <div class="similar-factor-name"><a href="/factors/{{ factor.registration_number|lower }}/">{{ factor.name|truncate(30) }}</a></div>
                        <span class="similar-factor-badge {{ factor.risk_band|lower }}">{{ factor.risk_band }}</span>
                        <div class="similar-factor-stats">{% if factor.combined_rating %}{{ "%.1f"|format(factor.combined_rating) }}★ · {% endif %}{% if factor.property_count %}{{ "{:,}".format(factor.property_count) }}{% else %}Unknown{% endif %} properties</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </section>
        {% endif %}
        
    </main>
    
    <!-- ==================== SIDEBAR ==================== -->
    <aside class="sidebar">
        
        <!-- CTA Box (hidden for non-switchable factor types and expired registrations) -->
        {% if profile.status == 'registered' and profile.factor_type not in ['RSL', 'Housing Association', 'Local Authority'] %}
        <div class="sidebar-card">
            <div class="cta-box">
                <h3 class="cta-title">Unhappy with your factor?</h3>
                {% if similar_factors and similar_factors|length > 0 %}
                <div class="cta-highlight">{{ similar_factors|length }} better-rated alternatives serve your area</div>
                {% endif %}
                <p class="cta-text">Get free, no-obligation quotes from better-rated factors.</p>
                <a href="/get-quotes/?from={{ profile.registration_number }}" class="cta-button">Get Quotes →</a>
            </div>
            <a href="/contact/?subject=correction&factor={{ profile.registration_number }}" class="correction-link">See something wrong? Submit a correction →</a>
        </div>
        {% else %}
        <div class="sidebar-card">
            <a href="/contact/?subject=correction&factor={{ profile.registration_number }}" class="correction-link" style="border-radius: var(--radius-lg);">See something wrong? Submit a correction →</a>
        </div>
        {% endif %}
        
        <!-- Contact Information -->
        <div class="sidebar-card">
            <div class="sidebar-section">
                <h3 class="sidebar-title">Contact</h3>
                {% if profile.status != 'registered' %}
                <p style="color: var(--slate-500); font-size: var(--text-sm);">Contact information not retained for expired registrations.</p>
                {% else %}
                {% if google_places and google_places.phone %}
                <div class="contact-item">
                    <svg class="contact-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                    <a href="tel:{{ google_places.phone }}" class="contact-value">{{ google_places.phone }}</a>
                </div>
                {% endif %}
                {% if profile.website or (google_places and google_places.website) %}
                {% set website = profile.website or google_places.website %}
                <div class="contact-item">
                    <svg class="contact-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                    <a href="{{ website }}" target="_blank" rel="noopener" class="contact-value">{{ website|replace('https://','')|replace('http://','')|replace('www.','')|truncate(30) }}</a>
                </div>
                {% endif %}
                {% if google_places and google_places.address %}
                <div class="contact-item">
                    <svg class="contact-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                    <span class="contact-value">{{ google_places.address }}</span>
                </div>
                {% endif %}
                {% if not google_places and not profile.website %}
                <p style="color: var(--slate-500); font-size: var(--text-sm);">No contact information available.</p>
                {% endif %}
                {% endif %}
            </div>
            
            <!-- Data Sources -->
            <div class="sidebar-section">
                <h3 class="sidebar-title">Data Sources</h3>
                <ul class="source-list">
                    <li class="source-item">
                        <svg class="source-check available" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                        <a href="https://www.gov.scot/publications/property-factor-register/" target="_blank" rel="noopener">Property Factor Register</a>
                    </li>
                    <li class="source-item">
                        {% if tribunal_full_history.case_count > 0 %}
                        <svg class="source-check available" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                        {% else %}
                        <svg class="source-check unavailable" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        {% endif %}
                        <span>Tribunal ({{ tribunal_full_history.case_count|default(0) }} cases)</span>
                    </li>
                    <li class="source-item">
                        {% if profile.ch_number %}<svg class="source-check available" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>{% else %}<svg class="source-check unavailable" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>{% endif %}
                        <span>Companies House</span>
                    </li>
                    <li class="source-item">
                        {% if profile.google_rating %}<svg class="source-check available" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>{% else %}<svg class="source-check unavailable" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>{% endif %}
                        <span>Google ({{ profile.google_review_count|default(0) }} reviews)</span>
                    </li>
                    <li class="source-item">
                        {% if profile.trustpilot_rating %}<svg class="source-check available" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>{% else %}<svg class="source-check unavailable" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>{% endif %}
                        <span>Trustpilot ({{ profile.trustpilot_review_count|default(0) }} reviews)</span>
                    </li>
                </ul>
            </div>
            
            <!-- Accreditation -->
            <div class="sidebar-section">
                <h3 class="sidebar-title">Accreditation</h3>
                <ul class="source-list">
                    <li class="source-item">
                        {% if profile.status == 'registered' %}
                        <svg class="source-check available" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                        <span>Scottish PF Register</span>
                        {% else %}
                        <svg class="source-check unavailable" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        <span>Previously registered</span>
                        {% endif %}
                    </li>
                    <li class="source-item">
                        {% if profile.tpi_member %}<svg class="source-check available" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>{% else %}<svg class="source-check unavailable" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>{% endif %}
                        <span>TPI Scotland Member</span>
                    </li>
                </ul>
            </div>
        </div>
        
    </aside>
    
</div>

</div>

<!-- Mobile Sticky CTA (hidden for non-switchable factor types and expired registrations) -->

{% if profile.status == 'registered' and profile.factor_type not in ['RSL', 'Housing Association', 'Local Authority'] %}

<div class="mobile-cta">
    <a href="/get-quotes/?from={{ profile.registration_number }}" style="color: white; font-weight: 600;">Get Free Quotes from Better-Rated Factors →</a>
</div>
{% endif %}

<!-- ==================== FOOTER ==================== -->

<footer class="site-footer">
    <div class="footer-grid">
        <div class="footer-col">
            <a href="/" class="logo" style="margin-bottom: var(--space-md); display: inline-flex; color: white;">
                <div class="logo-mark">CF</div>
                Compare Factors
            </a>
            <p class="footer-about">Helping Scottish homeowners make informed decisions with transparent, independent data.</p>
        </div>
        <div class="footer-col">
            <h4>Explore</h4>
            <a href="/factors/">All Factors</a>
            <a href="/areas/">By Area</a>
            <a href="/rankings/">Rankings</a>
            <a href="/tribunal/">Tribunal Cases</a>
        </div>
        <div class="footer-col">
            <h4>Guides</h4>
            <a href="/guides/how-to-switch-factors-scotland/">Switching Factors</a>
            <a href="/guides/complaints/">Making a Complaint</a>
            <a href="/guides/history-of-property-factoring-scotland/">History</a>
        </div>
        <div class="footer-col">
            <h4>About</h4>
            <a href="/methodology/">Our Methodology</a>
            <a href="/about/">About Us</a>
            <a href="/contact/">Contact</a>
            <a href="/privacy/">Privacy Policy</a>
        </div>
    </div>
    <div class="footer-disclaimer">
        Some summaries and statistics on this page are AI-generated from official sources. Always verify important information with <a href="https://housingandpropertychamber.scot/apply-tribunal/property-factors/property-factors-decisions" target="_blank" rel="noopener">official HPC records</a>.
    </div>
    <div class="footer-bottom">
        <div>© 2026 Compare Factors. Not affiliated with the Scottish Government.</div>
        <div>Data last updated: {{ generated_date }}</div>
    </div>
</footer>

<!-- Collapsible cases toggle script -->

<script>
// Mobile menu toggle
function toggleMenu() {
    document.querySelector('.burger').classList.toggle('active');
    document.getElementById('mobileNav').classList.toggle('active');
}

function toggleCases() {
    const casesList = document.getElementById('cases-list');
    const toggle = document.getElementById('cases-toggle');
    const toggleText = document.getElementById('toggle-text');
    const hiddenCases = casesList.querySelectorAll('.case-card.hidden');
    const visibleCases = casesList.querySelectorAll('.case-card:not(.hidden)');
    
    if (hiddenCases.length > 0) {
        hiddenCases.forEach(card => card.classList.remove('hidden'));
        toggleText.textContent = 'Show fewer cases';
        toggle.classList.add('expanded');
    } else {
        const cards = casesList.querySelectorAll('.case-card');
        cards.forEach((card, i) => {
            if (i >= 3) card.classList.add('hidden');
        });
        toggleText.textContent = 'Show ' + (cards.length - 3) + ' more recent cases';
        toggle.classList.remove('expanded');
    }
}
</script>

</body>
</html>