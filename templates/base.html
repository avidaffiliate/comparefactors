<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" href="/favicon-48x48.png" sizes="48x48">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
    <link rel="manifest" href="/site.webmanifest">
    <title>{% block title %}Compare Factors Scotland{% endblock %}</title>
    {% block meta %}{% endblock %}
    
    <!-- Preload fonts for faster rendering -->
    <link rel="preload" href="/static/fonts/fraunces-latin.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/static/fonts/source-sans-3-latin.woff2" as="font" type="font/woff2" crossorigin>

    <style>
        /* Inlined @font-face - eliminates render-blocking CSS request */
        @font-face {
            font-family: 'Fraunces';
            font-style: normal;
            font-weight: 400 700;
            font-display: swap;
            src: url('/static/fonts/fraunces-latin.woff2') format('woff2');
        }
        @font-face {
            font-family: 'Source Sans 3';
            font-style: normal;
            font-weight: 400 700;
            font-display: swap;
            src: url('/static/fonts/source-sans-3-latin.woff2') format('woff2');
        }

        /* ==================== CSS VARIABLES ==================== */
        :root {
            /* Navy scale - primary dark colors */
            --navy-950: #0a0f1a;
            --navy-900: #0f172a;
            --navy-800: #1e293b;
            --navy-700: #334155;
            
            /* Slate scale - neutral grays */
            /* Note: --slate-500 and lighter fail WCAG AA on white backgrounds */
            /* Use --slate-600 minimum for body text */
            --slate-700: #334155;
            --slate-600: #475569;
            --slate-500: #64748b;  /* Use only for large text or non-essential UI */
            --slate-400: #94a3b8;  /* Use only for borders/icons, not text */
            --slate-300: #cbd5e1;
            --slate-200: #e2e8f0;
            --slate-100: #f1f5f9;
            --slate-50: #f8fafc;
            --white: #ffffff;
            
            /* Gray scale (for expired/inactive states) */
            --gray-600: #4b5563;
            --gray-500: #6b7280;
            --gray-100: #f3f4f6;
            
            /* Status colors */
            --red-700: #b91c1c;
            --red-600: #dc2626;
            --red-500: #ef4444;
            --red-100: #fee2e2;
            --red-50: #fef2f2;
            
            --orange-700: #c2410c;
            --orange-600: #ea580c;
            --orange-100: #ffedd5;
            
            --amber-800: #92400e;
            --amber-700: #b45309;
            --amber-600: #d97706;
            --amber-500: #f59e0b;
            --amber-200: #fde68a;
            --amber-100: #fef3c7;
            --amber-50: #fffbeb;
            
            --green-700: #15803d;
            --green-600: #16a34a;
            --green-100: #dcfce7;
            --green-50: #f0fdf4;
            
            --emerald-700: #047857;
            --emerald-600: #059669;
            --emerald-100: #d1fae5;
            
            --blue-800: #1e40af;
            --blue-700: #1d4ed8;
            --blue-600: #2563eb;
            --blue-100: #dbeafe;
            --blue-50: #eff6ff;
            
            --indigo-600: #4f46e5;
            --indigo-100: #e0e7ff;
            --indigo-50: #eef2ff;
            
            --teal-600: #0d9488;
            --teal-500: #14b8a6;
            
            /* Semantic aliases (for page-specific styles) */
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --text-muted: #475569;  /* Changed from slate-500 to slate-600 for WCAG AA compliance */
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            --bg-muted: #f8fafc;
            --bg-hover: #f1f5f9;
            
            /* Typography */
            --font-display: 'Fraunces', Georgia, serif;
            --font-body: 'Source Sans 3', -apple-system, BlinkMacSystemFont, sans-serif;
            
            /* Spacing */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            
            /* Border Radius */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            
            /* Text Sizes */
            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.125rem;
            --text-xl: 1.25rem;
            --text-2xl: 1.5rem;
        }

        /* ==================== RESET & BASE ==================== */
        *, *::before, *::after { 
            box-sizing: border-box; 
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: var(--font-body);
            font-size: 16px;
            line-height: 1.6;
            color: var(--navy-800);
            background: var(--slate-50);
            -webkit-font-smoothing: antialiased;
        }
        
        /* Accessibility: Links must be distinguishable without relying on color alone */
        a { 
            color: var(--blue-600); 
            text-decoration: underline;
            text-decoration-thickness: 1px;
            text-underline-offset: 2px;
        }
        a:hover { 
            text-decoration: underline;
            text-decoration-thickness: 2px;
        }
        
        /* Navigation and button-style links can skip underline since context is clear */
        .nav-link,
        .nav-cta,
        .logo,
        .btn,
        .cta-btn,
        .mobile-cta-button,
        .footer-col a,
        .breadcrumb a,
        .mobile-nav a {
            text-decoration: none;
        }
        .nav-link:hover,
        .footer-col a:hover,
        .breadcrumb a:hover,
        .mobile-nav a:hover {
            text-decoration: underline;
        }
        .nav-cta:hover,
        .logo:hover,
        .btn:hover,
        .cta-btn:hover,
        .mobile-cta-button:hover {
            text-decoration: none;
        }
        
        /* Mobile CTA button - white background with navy text */
        .mobile-cta-button,
        .mobile-cta-button:link,
        .mobile-cta-button:visited,
        .mobile-cta-button:hover,
        .mobile-cta-button:active {
            color: var(--navy-900);
            background: white;
        }

        /* ==================== HEADER ==================== */
        .site-header {
            background: var(--white);
            border-bottom: 1px solid var(--slate-200);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            height: 68px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: var(--font-display);
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--navy-950);
            text-decoration: none;
        }
        .logo:hover {
            text-decoration: none;
        }
        
        .logo-mark {
            width: 32px;
            height: 32px;
            background: var(--navy-950);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
        }
        
        .nav {
            display: flex;
            align-items: center;
            gap: 24px;
        }
        
        .nav-link {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--slate-600);
            text-decoration: none;
            transition: color 0.15s;
        }
        .nav-link:hover {
            color: var(--navy-950);
            text-decoration: none;
        }
        
        .nav-cta {
            background: var(--navy-950);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            text-decoration: none;
            transition: background 0.15s;
        }
        .nav-cta:hover {
            background: var(--navy-800);
            text-decoration: none;
        }
        
        /* Mobile Menu */
        .burger {
            display: none;
            flex-direction: column;
            justify-content: center;
            gap: 5px;
            width: 28px;
            height: 28px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
        }

        .burger span {
            display: block;
            width: 100%;
            height: 2px;
            background: var(--navy-800);
            border-radius: 2px;
            transition: all 0.3s;
        }

        .burger.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .burger.active span:nth-child(2) {
            opacity: 0;
        }

        .burger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -5px);
        }

        .mobile-nav {
            display: none;
            position: absolute;
            top: 68px;
            left: 0;
            right: 0;
            background: var(--white);
            border-bottom: 1px solid var(--slate-200);
            padding: 16px 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .mobile-nav.active {
            display: block;
        }

        .mobile-nav a {
            display: block;
            padding: 12px 0;
            color: var(--slate-600);
            text-decoration: none;
            font-size: 1rem;
            font-weight: 500;
            border-bottom: 1px solid var(--slate-100);
        }

        .mobile-nav a:last-child {
            border-bottom: none;
        }

        .mobile-nav a:hover {
            color: var(--navy-900);
        }

        .mobile-nav a.nav-cta {
            color: white;
            background: var(--navy-950);
            margin-top: 12px;
            padding: 12px 16px;
            border-radius: 6px;
            text-align: center;
            border-bottom: none;
        }
        
        .mobile-nav a.nav-cta:hover {
            background: var(--navy-800);
            color: white;
        }

        /* ==================== BREADCRUMB ==================== */
        .breadcrumb {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-md) 24px;
            font-size: 0.85rem;
            color: var(--slate-600);  /* Changed from slate-500 for WCAG AA */
        }
        .breadcrumb a {
            color: var(--slate-600);  /* Changed from slate-500 for WCAG AA */
            text-decoration: none;
        }
        .breadcrumb a:hover {
            color: var(--navy-800);
        }
        .breadcrumb .sep {
            margin: 0 0.5rem;
            color: var(--slate-400);
        }

        /* ==================== MAIN CONTENT ==================== */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px var(--space-2xl);
        }

        /* ==================== TYPOGRAPHY ==================== */
        h1, h2, h3, h4 {
            font-family: var(--font-display);
            color: var(--navy-950);
            line-height: 1.3;
        }
        
        h1 { font-size: 2rem; font-weight: 700; }
        h2 { font-size: 1.5rem; font-weight: 600; }
        h3 { font-size: 1.25rem; font-weight: 600; }
        h4 { font-size: 1rem; font-weight: 600; }

        /* ==================== CARDS ==================== */
        .card {
            background: var(--white);
            border: 1px solid var(--slate-200);
            border-radius: 16px;
            padding: var(--space-lg);
        }
        
        .card-sm {
            border-radius: 8px;
            padding: var(--space-md);
        }

        /* ==================== BUTTONS ==================== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            font-family: var(--font-body);
            font-size: 0.95rem;
            font-weight: 600;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.15s;
        }
        
        .btn-primary {
            background: var(--navy-950);
            color: white;
        }
        .btn-primary:hover {
            background: var(--navy-800);
            text-decoration: none;
        }
        
        .btn-secondary {
            background: var(--white);
            color: var(--navy-800);
            border: 1px solid var(--slate-200);
        }
        .btn-secondary:hover {
            background: var(--slate-50);
            border-color: var(--slate-300);
            text-decoration: none;
        }

        /* ==================== RISK BADGES ==================== */
        .risk-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-radius: 6px;
        }
        
        .risk-badge--clean,
        .risk-badge.clean {
            background: var(--green-100);
            color: var(--green-700);
        }
        .risk-badge--green,
        .risk-badge.green {
            background: var(--green-100);
            color: var(--green-700);
        }
        .risk-badge--limited,
        .risk-badge.limited {
            background: var(--gray-100);
            color: var(--gray-600);
        }
        .risk-badge--orange,
        .risk-badge.orange {
            background: var(--orange-100);
            color: var(--orange-600);
        }
        .risk-badge--red,
        .risk-badge.red {
            background: var(--red-100);
            color: var(--red-700);
        }

        /* ==================== UTILITIES ==================== */
        .text-success { color: var(--green-600); }
        .text-warning { color: var(--amber-600); }
        .text-danger { color: var(--red-600); }
        .text-muted { color: var(--slate-600); }  /* Changed from slate-500 for WCAG AA */
        
        .risk-clean { color: var(--green-600); }
        .risk-green { color: var(--green-600); }
        .risk-limited { color: var(--gray-600); }
        .risk-orange { color: var(--orange-600); }
        .risk-red { color: var(--red-600); }

        /* ==================== FOOTER ==================== */
        .site-footer {
            background: var(--navy-950);
            color: rgba(255, 255, 255, 0.7);
            padding: 48px 24px 24px;
            margin-top: var(--space-2xl);
        }
        
        .footer-inner {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 48px;
            margin-bottom: 32px;
        }
        
        .footer-brand {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: var(--font-display);
            font-size: 1.25rem;
            font-weight: 600;
            color: white;
            margin-bottom: 12px;
        }
        .footer-brand .logo-mark {
            background: white;
            color: var(--navy-950);
        }
        
        .footer-about {
            font-size: 0.9rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .footer-col h4 {
            font-family: var(--font-body);
            font-weight: 600;
            color: white;
            font-size: 0.9rem;
            margin-bottom: 16px;
        }
        
        .footer-col a {
            display: block;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-decoration: none;
        }
        .footer-col a:hover {
            color: white;
            text-decoration: none;
        }
        
        .footer-bottom {
            padding-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
        }
        
        .footer-bottom a {
            color: rgba(255, 255, 255, 0.5);
        }
        .footer-bottom a:hover {
            color: white;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            .nav {
                display: none;
            }
            .burger {
                display: flex;
            }
            .footer-grid {
                grid-template-columns: 1fr 1fr;
                gap: 32px;
            }
            .footer-bottom {
                flex-direction: column;
                gap: 8px;
                text-align: center;
            }
            h1 { font-size: 1.75rem; }
            h2 { font-size: 1.35rem; }
        }
        
        @media (max-width: 480px) {
            .header-inner {
                padding: 0 16px;
            }
            .main-content {
                padding: 0 16px var(--space-xl);
            }
            .footer-grid {
                grid-template-columns: 1fr;
                gap: 24px;
            }
        }

        /* ==================== COOKIE CONSENT ==================== */
        .cf-cookie-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(2px);
            z-index: 9998;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .cf-cookie-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .cf-cookie-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            border-top: 1px solid var(--slate-200);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            z-index: 9999;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .cf-cookie-banner.active {
            transform: translateY(0);
        }

        .cf-cookie-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .cf-cookie-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .cf-cookie-title {
            display: flex;
            align-items: center;
            gap: 0.625rem;
            margin: 0;
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--navy-950);
        }

        .cf-cookie-icon {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
        }

        .cf-cookie-text {
            font-size: 0.9375rem;
            line-height: 1.6;
            color: var(--navy-800);
            margin: 0 0 1.25rem 0;
        }

        .cf-cookie-text a {
            color: var(--blue-600);
            text-decoration: underline;
            text-underline-offset: 2px;
        }

        .cf-cookie-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            align-items: center;
        }

        .cf-btn {
            padding: 0.75rem 1.5rem;
            font-size: 0.9375rem;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            font-family: inherit;
        }

        .cf-btn-accept {
            background: var(--green-600);
            color: white;
        }
        .cf-btn-accept:hover {
            background: var(--green-700);
            transform: translateY(-1px);
        }

        .cf-btn-reject {
            background: var(--white);
            color: var(--navy-800);
            border: 1.5px solid var(--slate-200);
        }
        .cf-btn-reject:hover {
            background: var(--slate-50);
            border-color: var(--slate-300);
        }

        .cf-btn-settings {
            background: transparent;
            color: var(--slate-500);
            padding: 0.75rem 1rem;
            text-decoration: underline;
            text-underline-offset: 2px;
        }
        .cf-btn-settings:hover {
            color: var(--navy-800);
        }

        .cf-cookie-settings {
            display: none;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--slate-200);
        }
        .cf-cookie-settings.active {
            display: block;
            animation: cfSlideDown 0.3s ease;
        }

        @keyframes cfSlideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .cf-settings-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--navy-950);
            margin: 0 0 1rem 0;
        }

        .cf-cookie-category {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 1rem;
            padding: 1rem;
            background: var(--slate-50);
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }
        .cf-cookie-category:last-of-type {
            margin-bottom: 1.25rem;
        }

        .cf-category-info { flex: 1; }
        .cf-category-name {
            font-weight: 600;
            color: var(--navy-800);
            margin: 0 0 0.25rem 0;
            font-size: 0.9375rem;
        }
        .cf-category-desc {
            font-size: 0.8125rem;
            color: var(--slate-500);
            margin: 0;
            line-height: 1.5;
        }

        .cf-toggle {
            position: relative;
            flex-shrink: 0;
        }
        .cf-toggle input {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }
        .cf-toggle-slider {
            display: block;
            width: 48px;
            height: 26px;
            background: var(--slate-300);
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.2s ease;
            position: relative;
        }
        .cf-toggle-slider::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
        }
        .cf-toggle input:checked + .cf-toggle-slider {
            background: var(--green-600);
        }
        .cf-toggle input:checked + .cf-toggle-slider::after {
            transform: translateX(22px);
        }
        .cf-toggle input:disabled + .cf-toggle-slider {
            background: var(--green-600);
            opacity: 0.6;
            cursor: not-allowed;
        }

        .cf-required-badge {
            display: inline-block;
            font-size: 0.6875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--slate-500);
            background: var(--slate-200);
            padding: 0.125rem 0.5rem;
            border-radius: 4px;
            margin-left: 0.5rem;
        }

        .cf-btn-save {
            background: var(--navy-950);
            color: white;
        }
        .cf-btn-save:hover {
            background: var(--navy-800);
            transform: translateY(-1px);
        }

        .cf-cookie-settings-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 44px;
            height: 44px;
            background: var(--navy-950);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
            z-index: 9990;
            display: none;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease, background 0.2s ease;
        }
        .cf-cookie-settings-btn:hover {
            background: var(--navy-800);
            transform: scale(1.05);
        }
        .cf-cookie-settings-btn svg {
            width: 22px;
            height: 22px;
            color: white;
        }
        .cf-cookie-settings-btn.active {
            display: flex;
        }

        @media (max-width: 640px) {
            .cf-cookie-inner { padding: 1.25rem; }
            .cf-cookie-header { flex-direction: column; }
            .cf-cookie-actions {
                flex-direction: column;
                width: 100%;
            }
            .cf-btn {
                width: 100%;
                text-align: center;
            }
            .cf-btn-settings { order: 3; }
            .cf-cookie-category {
                flex-direction: column;
                gap: 0.75rem;
            }
            .cf-toggle { align-self: flex-start; }
        }

    </style>
    {% block styles %}{% endblock %}
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="header-inner">
            <a href="/" class="logo">
                <div class="logo-mark">CF</div>
                Compare Factors
            </a>
            <nav class="nav">
                <a href="/factors/" class="nav-link">All Factors</a>
                <a href="/areas/" class="nav-link">By Area</a>
                <a href="/methodology/" class="nav-link">How We Score</a>
                <a href="/guides/" class="nav-link">Guides</a>
                <a href="/contribute/" class="nav-link">Contribute</a>
                <a href="/get-quotes/" class="nav-link nav-cta">Get Quotes</a>
            </nav>
            <button class="burger" onclick="toggleMenu()" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
        <div class="mobile-nav" id="mobileNav">
            <a href="/factors/">All Factors</a>
            <a href="/areas/">By Area</a>
            <a href="/methodology/">How We Score</a>
            <a href="/guides/">Guides</a>
            <a href="/contribute/">Contribute</a>
            <a href="/get-quotes/" class="nav-cta">Get Quotes</a>
        </div>
    </header>

    {% block content %}{% endblock %}

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-inner">
            <div class="footer-grid">
                <div class="footer-col">
                    <div class="footer-brand">
                        <div class="logo-mark">CF</div>
                        Compare Factors
                    </div>
                    <p class="footer-about">Helping Scottish homeowners make informed decisions with transparent, independent data.</p>
                </div>
                <div class="footer-col">
                    <h4>Explore</h4>
                    <a href="/factors/">All Factors</a>
                    <a href="/areas/">By Area</a>
                </div>
                <div class="footer-col">
                    <h4>Guides</h4>
                    <a href="/guides/how-to-switch-factors-scotland/">Switching Factors</a>
                    <a href="/guides/complaints/">Making a Complaint</a>
                    <a href="/guides/history-of-property-factoring-scotland/">History</a>
                </div>
                <div class="footer-col">
                    <h4>About</h4>
                    <a href="/methodology/">Our Methodology</a>
                    <a href="/about/">About Us</a>
                    <a href="/contact/">Contact</a>
                    <a href="/privacy/">Privacy Policy</a>
                </div>
            </div>
            <div class="footer-bottom">
                <div>© {{ current_year|default('2026') }} Compare Factors. Not affiliated with the Scottish Government.</div>
                <div>
                    <a href="/privacy/">Privacy</a> · 
                    <a href="/cookie-policy/">Cookies</a> · 
                    <a href="/terms/">Terms</a>
                </div>
            </div>
        </div>
    </footer>

    {% block scripts %}{% endblock %}
    <script>
    // Mobile menu toggle
    function toggleMenu() {
        document.querySelector('.burger').classList.toggle('active');
        document.getElementById('mobileNav').classList.toggle('active');
    }
    </script>

    <!-- Cookie Consent Banner -->
    <div class="cf-cookie-overlay" id="cfCookieOverlay"></div>
    
    <div class="cf-cookie-banner" id="cfCookieBanner" role="dialog" aria-modal="true" aria-labelledby="cfCookieTitle">
        <div class="cf-cookie-inner">
            <div class="cf-cookie-header">
                <h2 class="cf-cookie-title" id="cfCookieTitle">
                    <svg class="cf-cookie-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"/>
                        <circle cx="8" cy="9" r="1" fill="currentColor"/>
                        <circle cx="15" cy="8" r="1" fill="currentColor"/>
                        <circle cx="10" cy="14" r="1" fill="currentColor"/>
                        <circle cx="16" cy="13" r="1" fill="currentColor"/>
                        <circle cx="13" cy="17" r="1" fill="currentColor"/>
                    </svg>
                    We value your privacy
                </h2>
            </div>
            
            <p class="cf-cookie-text">
                We use cookies to improve your experience, analyse site traffic, and understand where our visitors come from. 
                You can choose which cookies you're happy with, and change your preferences at any time. 
                Read our <a href="/privacy/">Privacy Policy</a> and <a href="/cookie-policy/">Cookie Policy</a> to learn more.
            </p>

            <div class="cf-cookie-actions">
                <button type="button" class="cf-btn cf-btn-accept" id="cfAcceptAll">Accept all cookies</button>
                <button type="button" class="cf-btn cf-btn-reject" id="cfRejectAll">Reject non-essential</button>
                <button type="button" class="cf-btn cf-btn-settings" id="cfShowSettings">Manage preferences</button>
            </div>

            <div class="cf-cookie-settings" id="cfCookieSettings">
                <h3 class="cf-settings-title">Cookie preferences</h3>
                
                <div class="cf-cookie-category">
                    <div class="cf-category-info">
                        <p class="cf-category-name">
                            Essential cookies
                            <span class="cf-required-badge">Always on</span>
                        </p>
                        <p class="cf-category-desc">
                            Required for the website to function properly. These cannot be disabled as they enable core features like security, accessibility, and remembering your preferences.
                        </p>
                    </div>
                    <label class="cf-toggle">
                        <input type="checkbox" checked disabled data-cookie-category="essential">
                        <span class="cf-toggle-slider"></span>
                    </label>
                </div>

                <div class="cf-cookie-category">
                    <div class="cf-category-info">
                        <p class="cf-category-name">Analytics cookies</p>
                        <p class="cf-category-desc">
                            Help us understand how visitors use our site so we can improve it. We use privacy-focused analytics that don't track you across other websites. Data is anonymised.
                        </p>
                    </div>
                    <label class="cf-toggle">
                        <input type="checkbox" id="cfAnalyticsCookies" data-cookie-category="analytics">
                        <span class="cf-toggle-slider"></span>
                    </label>
                </div>

                <div class="cf-cookie-category">
                    <div class="cf-category-info">
                        <p class="cf-category-name">Marketing cookies</p>
                        <p class="cf-category-desc">
                            Used to show you relevant content and measure the effectiveness of our advertising. These may be set by third-party advertising partners.
                        </p>
                    </div>
                    <label class="cf-toggle">
                        <input type="checkbox" id="cfMarketingCookies" data-cookie-category="marketing">
                        <span class="cf-toggle-slider"></span>
                    </label>
                </div>

                <div class="cf-cookie-actions">
                    <button type="button" class="cf-btn cf-btn-save" id="cfSavePreferences">Save preferences</button>
                </div>
            </div>
        </div>
    </div>

    <button type="button" class="cf-cookie-settings-btn" id="cfFloatingSettings" aria-label="Cookie settings" title="Cookie settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <circle cx="8" cy="9" r="1" fill="currentColor"/>
            <circle cx="15" cy="8" r="1" fill="currentColor"/>
            <circle cx="10" cy="14" r="1" fill="currentColor"/>
        </svg>
    </button>

    <script>
    /**
     * Compare Factors Scotland - Cookie Consent Manager
     * UK GDPR & PECR Compliant
     */
    (function() {
        'use strict';

        const CONSENT_COOKIE_NAME = 'cf_cookie_consent';
        const CONSENT_VERSION = '1.0';
        const CONSENT_EXPIRY_DAYS = 365;

        const banner = document.getElementById('cfCookieBanner');
        const overlay = document.getElementById('cfCookieOverlay');
        const settingsPanel = document.getElementById('cfCookieSettings');
        const floatingBtn = document.getElementById('cfFloatingSettings');
        
        const acceptAllBtn = document.getElementById('cfAcceptAll');
        const rejectAllBtn = document.getElementById('cfRejectAll');
        const showSettingsBtn = document.getElementById('cfShowSettings');
        const savePreferencesBtn = document.getElementById('cfSavePreferences');
        
        const analyticsToggle = document.getElementById('cfAnalyticsCookies');
        const marketingToggle = document.getElementById('cfMarketingCookies');

        function getConsent() {
            try {
                const cookie = document.cookie
                    .split('; ')
                    .find(row => row.startsWith(CONSENT_COOKIE_NAME + '='));
                
                if (cookie) {
                    const value = JSON.parse(decodeURIComponent(cookie.split('=')[1]));
                    if (value.version === CONSENT_VERSION) {
                        return value;
                    }
                }
            } catch (e) {
                console.warn('Error reading consent cookie:', e);
            }
            return null;
        }

        function setConsent(preferences) {
            const value = {
                version: CONSENT_VERSION,
                timestamp: new Date().toISOString(),
                essential: true,
                analytics: preferences.analytics || false,
                marketing: preferences.marketing || false
            };

            const expires = new Date();
            expires.setDate(expires.getDate() + CONSENT_EXPIRY_DAYS);

            document.cookie = CONSENT_COOKIE_NAME + '=' + encodeURIComponent(JSON.stringify(value)) + '; ' +
                'expires=' + expires.toUTCString() + '; ' +
                'path=/; ' +
                'SameSite=Lax; ' +
                'Secure';

            window.dispatchEvent(new CustomEvent('cfConsentUpdated', { detail: value }));
            return value;
        }

        function showBanner() {
            banner.classList.add('active');
            overlay.classList.add('active');
            floatingBtn.classList.remove('active');
            document.body.style.overflow = 'hidden';
        }

        function hideBanner() {
            banner.classList.remove('active');
            overlay.classList.remove('active');
            settingsPanel.classList.remove('active');
            floatingBtn.classList.add('active');
            document.body.style.overflow = '';
        }

        function toggleSettings() {
            settingsPanel.classList.toggle('active');
            showSettingsBtn.textContent = settingsPanel.classList.contains('active') 
                ? 'Hide preferences' 
                : 'Manage preferences';
        }

        function loadConsentedScripts(consent) {
            if (consent.analytics && !window.cfGA4Loaded) {
                var script = document.createElement('script');
                script.async = true;
                script.src = 'https://www.googletagmanager.com/gtag/js?id=G-P9QSNCJEBQ';
                script.onload = function() {
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){dataLayer.push(arguments);}
                    window.gtag = gtag;
                    gtag('js', new Date());
                    gtag('config', 'G-P9QSNCJEBQ', {
                        'anonymize_ip': true,
                        'cookie_flags': 'SameSite=Lax;Secure'
                    });
                };
                document.head.appendChild(script);
                window.cfGA4Loaded = true;
            }
        }

        function removeNonEssentialCookies(consent) {
            consent = consent || { analytics: false, marketing: false };
            var analyticsCookies = ['_ga', '_gid', '_gat'];
            var marketingCookies = ['_fbp', '_fbc', '_gcl_au'];
            var cookiesToRemove = [];
            
            if (!consent.analytics) cookiesToRemove = cookiesToRemove.concat(analyticsCookies);
            if (!consent.marketing) cookiesToRemove = cookiesToRemove.concat(marketingCookies);

            document.cookie.split(';').forEach(function(cookie) {
                var name = cookie.split('=')[0].trim();
                var shouldRemove = cookiesToRemove.some(function(pattern) {
                    return name === pattern || name.startsWith(pattern + '_');
                });
                if (shouldRemove) {
                    document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/';
                    document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; domain=' + window.location.hostname;
                    document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; domain=.' + window.location.hostname;
                }
            });
        }

        function acceptAll() {
            var consent = setConsent({ analytics: true, marketing: true });
            hideBanner();
            loadConsentedScripts(consent);
        }

        function rejectAll() {
            setConsent({ analytics: false, marketing: false });
            hideBanner();
            removeNonEssentialCookies();
        }

        function savePreferences() {
            var consent = setConsent({
                analytics: analyticsToggle.checked,
                marketing: marketingToggle.checked
            });
            hideBanner();
            loadConsentedScripts(consent);
            if (!consent.analytics || !consent.marketing) {
                removeNonEssentialCookies(consent);
            }
        }

        function updateTogglesFromConsent(consent) {
            analyticsToggle.checked = consent.analytics;
            marketingToggle.checked = consent.marketing;
        }

        function init() {
            var existingConsent = getConsent();

            if (existingConsent) {
                floatingBtn.classList.add('active');
                updateTogglesFromConsent(existingConsent);
                loadConsentedScripts(existingConsent);
            } else {
                showBanner();
            }

            acceptAllBtn.addEventListener('click', acceptAll);
            rejectAllBtn.addEventListener('click', rejectAll);
            showSettingsBtn.addEventListener('click', toggleSettings);
            savePreferencesBtn.addEventListener('click', savePreferences);
            floatingBtn.addEventListener('click', function() {
                var consent = getConsent();
                if (consent) updateTogglesFromConsent(consent);
                showBanner();
            });

            banner.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    var consent = getConsent();
                    if (consent) hideBanner();
                }
            });
        }

        window.cfCookieConsent = {
            getConsent: getConsent,
            hasAnalyticsConsent: function() {
                var consent = getConsent();
                return consent ? consent.analytics : false;
            },
            hasMarketingConsent: function() {
                var consent = getConsent();
                return consent ? consent.marketing : false;
            },
            showBanner: showBanner
        };

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    })();
    </script>
</body>
</html>